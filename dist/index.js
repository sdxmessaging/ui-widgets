(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("lodash"),require("mithril"),require("mithril/stream"),require("signature_pad")):typeof define==="function"&&define.amd?define(["exports","lodash","mithril","mithril/stream","signature_pad"],t):(e=e||self,t(e.uiWidgets={},e._,e.m,e.m.stream,e.SignaturePad))})(this,function(e,p,d,t,n){"use strict";p=p&&p.hasOwnProperty("default")?p["default"]:p;d=d&&d.hasOwnProperty("default")?d["default"]:d;t=t&&t.hasOwnProperty("default")?t["default"]:t;n=n&&n.hasOwnProperty("default")?n["default"]:n;var v="border-box bn";var h="fw2 dark-gray";var l=Math.max(window.devicePixelRatio||1,1);function s(e,t){var a=e.label;return d("span.mr2.silver.truncate",{title:a,class:t},a)}function m(e){var t=e.id,a=e.label,r=e.required;return d("label.mb1.silver",{title:a,for:t},c(a,r))}function c(e,t){return t?e+"*":e}function i(e,t){return t?t:e}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,a=e=="x"?t:t&3|8;return a.toString(16)})}function u(e,t){return p.find(e,p.matches(t))}function a(e,t){return p.remove(e,p.matches(t))}function f(e){var t=e.lastIndexOf(".");return[e.substr(0,t),e.substr(t)]}function g(e){var t=e.split(",");var a=t[0].indexOf("base64")>=0?atob(t[1]):unescape(t[1]);var r=t[0].split(":")[1].split(";")[0];var n=a.length;var i=new Uint8Array(n);for(var o=0;o<n;o++){i[o]=a.charCodeAt(o)}return new Blob([i],{type:r})}function y(e,t,a){if(e>t){if(e>a){return[a,Math.round(t*a/e)]}}else if(t>a){return[Math.round(e*a/t),a]}return[e,t]}function x(a,u,c){return new Promise(function(s,e){if(!a.type.match(/image.*/)){e(new Error("File most be an image"));return}var t=new FileReader;t.onload=function(e){if(!(e&&e.target)){return}var o=e.target.result;var l=new Image;l.onload=function(){var e=document.createElement("canvas");var t=y(l.width,l.height,u),a=t[0],r=t[1];var n=w(o);if(n>4){e.width=r;e.height=a}else{e.width=a;e.height=r}var i=e.getContext("2d");if(i){k(i,a,r,n);i.drawImage(l,0,0,a,r)}s(e.toDataURL(c))};var t=new Blob([o]);l.src=window.URL.createObjectURL(t)};t.readAsArrayBuffer(a)})}function w(e){var t=Math.min(e.byteLength,64*1024);var a=new DataView(e,0,t);if(a.getUint16(0,false)!==65496){return-2}var r=a.byteLength;var n=2;while(n<r){var i=a.getUint16(n,false);n+=2;if(i===65505){if(a.getUint32(n+=2,false)!==1165519206){return-1}var o=a.getUint16(n+=6,false)===18761;n+=a.getUint32(n+4,o);var l=a.getUint16(n,o);n+=2;for(var s=0;s<l;s++){if(a.getUint16(n+s*12,o)===274){return a.getUint16(n+s*12+8,o)}}}else if((i&65280)!==65280){break}else{n+=a.getUint16(n,false)}}return-1}function k(e,t,a,r){if(!r||r>8){return}switch(r){case 2:e.translate(t,0);e.scale(-1,1);return;case 3:e.translate(t,a);e.rotate(Math.PI);return;case 4:e.translate(0,a);e.scale(1,-1);return;case 5:e.rotate(.5*Math.PI);e.scale(1,-1);return;case 6:e.rotate(.5*Math.PI);e.translate(0,-a);return;case 7:e.rotate(.5*Math.PI);e.translate(t,-a);e.scale(-1,1);return;case 8:e.rotate(-.5*Math.PI);e.translate(-t,0);return}}var _=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.label,r=t.type,n=r===void 0?"button":r,i=t.icon,o=t.classes,l=t.disabled,s=t.style,u=t.onclick;return d("button.button-reset.pa2.bn.br2"+b.bgBranding.brandingAlt,{type:n,class:""+(l?"o-60 ":"")+o,disabled:l,style:s,onclick:u},i?d("i.fal.fa-fw.mr2",{class:i}):null,a)};return e}();var r=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=a.classes,n=a.style,i=t.value;return d(".pa2",{class:r,style:n},d.trust(i()))};return e}();var L=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.classes,i=a.style;return d(".pa2.flex.flex-wrap.bb.b--black-20",{class:n,style:i},[s(a),d("span.ws-normal",{title:r()},r())])};return e}();function P(e,t){if(e==="email"){return{href:"mailto:"+t}}else if(e==="tel"){return{href:"tel:"+t}}else{return{href:t,target:"_blank"}}}var C={email:"fa-envelope",tel:"fa-phone"};var I=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.classes,i=a.style;return d(".pa2.flex.flex-wrap.bb.b--black-20",{class:n,style:i},[s(a),r?d("a.link.dark-gray.dim.pointer.ws-normal",P(a.type,r()),d("i.fal.mr2",{class:C[a.type]}),r()):null])};return e}();var U=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.classes,i=a.style;return d(".pa2.flex.flex-wrap.bb.b--black-20",{class:n,style:i},[s(a),d("i.fal.self-end",{class:r()?"fa-check":"fa-times"})])};return e}();var F=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.classes,i=a.style;var o=u(a.options,{value:r()});var l=o?o.label:r();return d(".pa2.flex.flex-wrap.bb.b--black-20",{class:n,style:i},[s(a),d("span.ws-normal",{title:l},l)])};return e}();var S=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.classes,i=a.style;return d(".pa2.flex.flex-column.bb.b--black-20",{class:n,style:i},[s(a,"mb1"),d(".flex.flex-column.mt1.nb1",p.map(r(),function(e){var t=e.name,a=e.path;return d("a.pa2.mv1.link.ba.b--black-20.dark-gray.dim.pointer[target=_blank]",{href:a},[d("i.fal.fa-file-download.mr2"),t])}))])};return e}();var O=function(){function e(){}e.prototype.view=function(e){var t=e.children,a=e.attrs;return d(".relative.w-third.w-25-m.w-20-l.pa1.tc.hide-child",[d("img.contain",a),t])};return e}();var j=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.classes,i=a.style;return d(".pa2.flex.flex-column.bb.b--black-20",{class:n,style:i},[s(a,"mb2"),d(".flex.flex-row.flex-wrap.mt1.nr1.nb1.nl1",p.map(r(),function(e){var t=e.name,a=e.path;return d(O,{title:t,src:a,style:{"max-height":"6rem"}})}))])};return e}();var R=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.classes,i=a.style;var o=p.head(r());return d(".pa2.flex.flex-column.bb.b--black-20",{class:n,style:i},[s(a,"mb1"),o?d("img.img.contain.self-center"+b.imgHeight,{title:o.name,src:o.path}):d("i.fal.fa-image")])};return e}();var z=function(){function e(){}e.prototype.view=function(e){var t=e.attrs.field,a=t.label,r=t.required;return d("label.mb2",c(a,r))};return e}();var q=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.id,i=a.type,o=a.placeholder,l=a.containerClass,s=a.classes,u=s===void 0?"":s,c=a.required,f=a.disabled;return[m(a),d(".w-100",{class:l},d("input.input-reset.w-100.pa2"+b.inputHeight,{id:n,name:n,value:r(),class:""+(f?"o-60 ":"")+u+" "+v+" "+h,type:i,placeholder:o,required:c,disabled:f,onchange:function(e){var t=e.target.value;return r(t)}}))]};return e}();var A=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.id,i=a.placeholder,o=a.classes,l=a.containerClass,s=a.required,u=a.disabled;return[m(a),d("div",{class:l},d("textarea.w-100.pa2[rows=3]",{id:n,name:n,value:r(),class:""+(u?"o-60 ":"")+o+" "+v+" "+h,placeholder:i,style:{resize:"vertical"},required:s,disabled:u,onchange:function(e){var t=e.target.value;return r(t)}}))]};return e}();var T=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a.id,i=a.label,o=a.classes,l=a.containerClass,s=a.required,u=a.disabled;return d("div.pa2",{class:l},d(".flex.flex-wrap",{class:h},d("label.flex.items-center.dark-gray",{class:""+(u?"o-60 ":"")+o},d("input.mr1[type=checkbox]",{id:n,name:n,checked:r(),required:s,disabled:u,onchange:function(e){var t=e.target.checked;return r(t)}}),c(i,s))))};return e}();var M=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a;var i=n.id,o=n.options,l=n.classes,s=n.containerClass,u=n.disabled;return[m(n),d("div",{class:s},d(".flex.flex-wrap",{class:h,onchange:function(e){var t=e.target.value;return r(t)}},p.map(o,function(e){var t=e.label,a=e.value;return d("label.flex.items-center.ma2",{class:u?"o-60":"pointer"},d("input.mr1[type=radio]",{name:i,value:a,checked:r()===a,class:l,disabled:u}),t)})))]};return e}();var B=function(){function e(){}e.prototype.view=function(e){var t=e.attrs,a=t.field,r=t.value;var n=a,i=n.id,o=n.options,l=n.containerClass,s=n.classes,u=s===void 0?"":s,c=n.required,f=n.disabled;return[m(a),d("div",{class:l},d("select.input-reset.w-100.pa2"+b.inputHeight,{id:i,name:i,value:r(),class:""+(f?"o-60 ":"")+u+" "+v+" "+h,required:c,disabled:f,onchange:function(e){var t=e.target.value;return r(t)}},p.map(o,function(e){return d("option",{value:e.value},e.label)})))]};return e}();var D=function(){function e(){this.acceptTypes="*";this.multiple=true;this.dragging=false;this.fileList=t([])}e.prototype.oninit=function(e){var t=e.attrs.value;this.fileList=t};e.prototype.view=function(e){var a=this;var t=e.attrs.field;var r=t.id,n=t.label,i=t.containerClass,o=t.required,l=t.disabled;return d("div",[d("label.flex.flex-column",p.extend({for:r,title:n,class:(l?"o-60":"pointer")+" "+i},l?{}:{ondragover:function(e){return a.dragStart(e)},ondragleave:function(e){return a.dragStop(e)},ondrop:function(e){a.dragStop(e);if(e.dataTransfer){a.addFiles(e.dataTransfer.files)}}}),[d("input.clip",{id:r,name:r,type:"file",multiple:this.multiple,accept:this.acceptTypes,required:o,disabled:l,onchange:function(e){var t=e.target.files;a.addFiles(t)}}),d("span.mb1.silver",n),this.viewUploadWidget(t)]),this.viewFileList()])};e.prototype.viewUploadWidget=function(e){return d(".pa2.ba.b--dashed.br2",{class:this.dragging?"b--blue blue":"b--light-silver dark-gray"},[d("i.fal.fa-file-upload.mr2"),d("span","Add file(s)...")])};e.prototype.viewFileList=function(){var t=this;return d(".flex.flex-column.mt1.nb1",p.map(this.fileList(),function(e){return d("span.pa2.mv1.ba.b--black-20.hide-child.dim.pointer",[d("i.fal.fa-file-download.mr2"),e.name,d("i.fal.fa-file-minus.child.fr",{title:"Remove "+e.name,onclick:function(){return t.removeFile(e.guid)}})])}))};e.prototype.addFiles=function(e){var t=this.fileList();p.each(e,function(e){t.push({guid:o(),name:e.name,path:"not_set",file:e})});this.fileList(t)};e.prototype.removeFile=function(e){var t=this.fileList();a(t,{guid:e});this.fileList(t)};e.prototype.dragStart=function(e){e.preventDefault();if(e.dataTransfer){e.dataTransfer.dropEffect="copy"}if(this.dragging){e.redraw=false}this.dragging=true};e.prototype.dragStop=function(e){e.preventDefault();this.dragging=false};return e}();var E=this&&this.__extends||function(){var r=function(e,t){r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a]};return r(e,t)};return function(e,t){r(e,t);function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}();var W=function(t){E(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.multiple=false;return e}e.prototype.viewUploadWidget=function(e){var t=p.head(this.fileList());return d(".pa2.ba.b--dashed.br2",{class:this.dragging?"b--blue blue":"b--light-silver dark-gray"},[d("i.fal.fa-file-upload.mr2"),d("span",t?t.name:"Upload...")])};e.prototype.viewFileList=function(){return null};e.prototype.addFiles=function(e){var t=p.head(e);if(!t){return}this.setFile({guid:this.getFileId(),name:t.name,path:"not_set",file:t})};e.prototype.getFileId=function(){var e=p.head(this.fileList());return e?e.guid:o()};e.prototype.setFile=function(e){this.fileList([e])};return e}(D);var H=this&&this.__extends||function(){var r=function(e,t){r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a]};return r(e,t)};return function(e,t){r(e,t);function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}();var N=function(t){H(a,t);function a(){var e=t!==null&&t.apply(this,arguments)||this;e.acceptTypes="image/*";return e}a.prototype.viewUploadWidget=function(e){var t=e.classes,a=t===void 0?"h3":t;return d(".w-100.pa1.ba.bw1.b--dashed.br3.dt.tc",{class:a+" "+(this.dragging?"b--blue blue":"b--light-silver dark-gray")},d("i.fal.fa-camera.fa-2x.dtc.v-mid"))};a.prototype.viewFileList=function(){var t=this;return d(".flex.flex-row.flex-wrap.mt1.nr1.nb1.nl1",p.map(this.fileList(),function(e){return d(O,{src:i(e.path,e.dataUrl),class:"dim",style:{"max-height":"6rem"}},d(".pa2.bg-white.ba.b--light-silver.br2.absolute.top-0.right-0.child.pointer",{title:"Remove "+e.name,onclick:function(){return t.removeFile(e.guid)}},d("i.fal.fa-file-minus.fa-lg")))}))};a.prototype.addFiles=function(e){var t=this;var n="image/jpeg";var i=this.fileList();Promise.all(p.map(e,function(r){return x(r,a.maxImageSize,n).then(function(e){var t=f(r.name)[0];var a=new File([g(e)],t+".jpg",{type:n});i.push({guid:o(),name:a.name,path:"not_set",file:a,dataUrl:e})})})).then(function(){t.fileList(i);d.redraw()})};a.maxImageSize=1280;return a}(D);var V=this&&this.__extends||function(){var r=function(e,t){r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a]};return r(e,t)};return function(e,t){r(e,t);function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}();var G=function(t){V(a,t);function a(){var e=t!==null&&t.apply(this,arguments)||this;e.multiple=false;e.acceptTypes="image/*";return e}a.prototype.viewUploadWidget=function(e){var t=e.classes,a=t===void 0?"h5":t;var r=p.head(this.fileList());return d(".w-100.pa1.contain.ba.bw1.b--dashed.br3.dt.tc",{class:a+" "+(this.dragging?"b--blue blue":"b--light-silver dark-gray")},r?d("img.img"+b.imgHeight,{src:i(r.path,r.dataUrl)}):d("i.fal.fa-camera.fa-2x.dtc.v-mid"))};a.prototype.addFiles=function(e){var r=this;var n=p.head(e);if(!n){return}var i="image/jpeg";x(n,a.maxImageSize,i).then(function(e){var t=f(n.name)[0];var a=new File([g(e)],t+".jpg",{type:i});r.setFile({guid:r.getFileId(),name:a.name,path:"not_set",file:a,dataUrl:e});d.redraw()})};a.maxImageSize=1280;return a}(W);var J=function(){function e(){this.signaturePad=null}e.prototype.oncreate=function(e){var t=this;var a=e.dom;var r=a.children[0];this.signaturePad=new n(r,{minWidth:.5*l,maxWidth:1.5*l});this.resizeCanvas=p.debounce(function(){r.width=r.offsetWidth*l;r.height=r.offsetHeight*l;var e=r.getContext("2d");if(e&&t.signaturePad){e.scale(l,l);t.signaturePad.clear()}},250);window.addEventListener("resize",this.resizeCanvas);window.addEventListener("orientationchange",this.resizeCanvas);this.resizeCanvas()};e.prototype.onremove=function(){window.removeEventListener("resize",this.resizeCanvas);window.removeEventListener("orientationchange",this.resizeCanvas)};e.prototype.view=function(e){var t=this;var a=e.attrs,r=a.onSet,n=a.onCancel;return[d(".aspect-ratio.ba.bw1.br3.b--dashed.b--black-30"+b.aspectRatio4x1,d("canvas.aspect-ratio--object")),d(".flex.flex-row.nl1.nr1.mb1",[d(_,{label:"Apply",icon:"fa-check",classes:"ma1",onclick:function(){if(t.signaturePad&&!t.signaturePad.isEmpty()){r(t.signaturePad.toDataURL("image/png"))}}}),d(_,{label:"Reset",icon:"fa-eraser",classes:"ma1",onclick:function(){return t.resetCanvas()}}),d(_,{label:"Cancel",icon:"fa-times",classes:"ma1",onclick:n})])]};e.prototype.resetCanvas=function(){if(this.signaturePad){this.signaturePad.clear()}};e.prototype.resizeCanvas=function(){p.noop()};return e}();var K=function(){function e(){this.text=t("")}e.prototype.oncreate=function(e){var t=e.dom;var a=t.children[0];a.focus({preventScroll:false})};e.prototype.view=function(e){var a=this;var t=e.attrs,r=t.onSet,n=t.onCancel;var i=60*l;var o=480*l;return[d(".aspect-ratio.ba.bw1.br3.b--dashed.b--black-30"+b.aspectRatio4x1,d("input.aspect-ratio--object.pa2.ba.bw0[type=text]",{onkeypress:function(e){var t=e.keyCode;if(t===13&&a.text()){r(Q(a.text()));return false}return true},oninput:function(e){var t=e.target.value;return a.text(t)},value:this.text(),style:{"font-size":"calc("+i+"px + ("+i+" / "+o+" * (100vw - "+o+"px)))","font-family":"Caveat"}})),d(".flex.flex-row.nl1.nr1.mb1",[d(_,{label:"Apply",icon:"fa-check",classes:"ma1",onclick:function(){if(a.text()){r(Q(a.text()))}}}),d(_,{label:"Reset",icon:"fa-eraser",classes:"ma1",onclick:function(){return a.text("")}}),d(_,{label:"Cancel",icon:"fa-times",classes:"ma1",onclick:n})])]};return e}();function Q(e){var t=document.createElement("canvas");var a=90*l;t.width=600*l;t.height=150*l;var r=t.getContext("2d");if(r){r.textBaseline="middle";r.font=a+"px Caveat";r.fillText(e,6*l,t.height*.52)}return t.toDataURL()}var X=this&&this.__extends||function(){var r=function(e,t){r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a]};return r(e,t)};return function(e,t){r(e,t);function a(){this.constructor=e}e.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}}();var Y=function(t){X(n,t);function n(){var e=t!==null&&t.apply(this,arguments)||this;e.state=0;return e}n.prototype.view=function(e){var t=this;var a=e.attrs.field;var r=a.containerClass;var n=p.head(this.fileList());return d(".flex.flex-column",{class:r},[d(".mb1.flex.flex-row",[m(a),d("span.ph2.mh2.ml-auto.dark-gray",{class:this.state===1?b.brandingAlt.class:"dim pointer",onclick:function(){return t.state=1}},d("i.fal.fa-fw.fa-pen")),d("span.ph2.mh2.dark-gray",{class:this.state===2?b.brandingAlt.class:"dim pointer",onclick:function(){return t.state=2}},d("i.fal.fa-fw.fa-keyboard"))]),this.state===0?d(".aspect-ratio.dark-gray.ba.bw1.br3.b--dashed.b--black-30.pointer"+b.aspectRatio4x1,{onclick:function(){return t.state=1}},n?d("img.aspect-ratio--object",{src:i(n.path,n.dataUrl)}):d(".aspect-ratio--object.flex.items-center.justify-center",[d("i.fal.fa-pen-nib.fa-2x"),d("span.ml2","Sign")])):d(this.state===1?J:K,{onSet:function(e){return t.setDataUrl(e,a.id)},onCancel:function(){return t.state=0}})])};n.prototype.setDataUrl=function(e,a){var r=this;Z(e,n.maxImageSize).then(function(e){var t=new File([g(e)],"sign-"+a+".png",{type:"image/png"});r.setFile({guid:r.getFileId(),name:t.name,path:"not_set",file:t,dataUrl:e});r.state=0;d.redraw()})};n.maxImageSize=640;return n}(W);function Z(e,l){return new Promise(function(i){var o=new Image;o.onload=function(){var e=document.createElement("canvas");var t=y(o.width,o.height,l),a=t[0],r=t[1];e.width=a;e.height=r;var n=e.getContext("2d");if(n){n.drawImage(o,0,0,a,r)}i(e.toDataURL())};o.src=e})}e.BaseInput=q;e.BaseText=L;e.Button=_;e.Checkbox=U;e.CheckboxInput=T;e.FileDownload=S;e.FileMulti=D;e.FileSelect=W;e.ImageList=j;e.ImageMulti=N;e.ImagePreview=R;e.ImageSelect=G;e.Label=z;e.Link=I;e.RadioInput=M;e.SelectInput=B;e.SelectText=F;e.SignBuilder=Y;e.TextareaInput=A;e.Trusted=r;e.dataURItoBlob=g;e.fileNameExtSplit=f;e.getDisplayLabel=s;e.getLabel=m;e.getLabelText=c;e.guid=o;e.iconMap=C;e.imgSrc=i;e.inputBorder=v;e.inputText=h;e.linkAttrs=P;e.pickByProperty=u;e.pxRatio=l;e.removeByProperty=a;e.resizeImage=x;e.scaleRect=y;Object.defineProperty(e,"__esModule",{value:true})});
