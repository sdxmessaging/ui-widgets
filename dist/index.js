/* @preserve built on: 2024-09-10T14:51:24.367Z */
import e from"lodash";import t from"mithril";import a from"mithril/stream";import{DateTime as n}from"luxon";import i from"flatpickr";import s from"signature_pad";const l={wrapper:"",label:"silver",inputWrapper:"ba br2 b--silver pa2 ma0 dark-gray",input:"dark-gray fw2",button:"pa2 bn br2",navButton:"dark-gray",textarea:"dark-gray fw2",fileInputWrapper:"ba bw1 br3 b--black-30 b--dashed dark-gray",fileHover:"blue b--blue",displayLabel:"silver",displayValue:"dark-gray",requiredLabel:"",requiredInputWrapper:"",readonlyInputWrapper:"",disabledWrapper:"o-40",disabledInputWrapper:"",invalidInputWrapper:"ba b--red",focusInputWrapper:"",altLabel:"ml1 o-70",floatLabelPlaceholder:"",invalidCheckboxWrapper:"red",tooltipWrapper:"dib relative mh2",tooltipIconBackground:"bg-black h2 w2 relative br-100 ",tooltipIcon:"white f6",tooltipMessage:"white bg-black w5 f6 pa2 absolute br2 z-max",redNumber:"red fw2",checkListOptionsWrapper:"ba br2 b--silver pa2 dark-gray bg-canvas w-100 max-h-img overflow-y-auto shadow-4",checkListOption:"pa2 hover-bg-light-gray",checkListOptionLabel:"mh1",checkListOptionIcon:"mh1",checkListOptionSingleSelected:"bg-light-blue fw6",checkListOptionMultiSelected:"fw6",timeInputScrollerWrapper:"ba br2 b--silver pa2 dark-gray bg-canvas top-2 shadow-4",timeInputScrollerNumber:"pv1 mv2 w-100 mw-dd tc f6 fw6 bg-light-gray"};const r=l;function o(t){e.assign(l,t)}const c={default:"bg-light-blue dark-gray"};function d(t){e.assign(c,t)}function u(e="default"){if(e&&e in c){return c[e]}else{return""}}function h(t){return e.compact(t).join(" ")}function p(e,t={}){if(e in t){return t.merge===false?[t[e]]:[t[e],r[e]]}else{return[r[e]]}}function f(e,t){return h([...p("wrapper",e),t?r.disabledWrapper:""])}function m(e,t){return h([...p("label",e),t?r.requiredLabel:""])}function g({required:e,uiClass:t},a){return h([m(t,e),a?"f-07em cursor-default":`${r.floatLabelPlaceholder} cursor-text`])}function b({required:e,readonly:t,disabled:a,uiClass:n},i,s){return h([...p("inputWrapper",n),...i?p("invalidInputWrapper",n):[],e?r.requiredInputWrapper:null,t?r.readonlyInputWrapper:null,a?r.disabledInputWrapper:null,s?r.focusInputWrapper:null])}function v(e){return h(p("input",e))}function y({readonly:e,disabled:t,uiClass:a}){return h([v(a),k(t,e)])}function x({input:e,merge:t=true}){return h([e,t?r.textarea:null])}function w({inputWrapper:e,merge:t=true},a,n){return h([e,t?r.fileInputWrapper:null,n?r.invalidInputWrapper:null,a?r.fileHover:""])}function k(e,t){return e||t?undefined:"pointer"}const I={layoutType:"default",tooltipIcon:"fas fa-info",imageMaxSize:1280,addFileTxt:"Upload...",addFilesTxt:"Add file(s)...",remFileTtl:"Remove",openFileTxt:"Open file",showPassTxt:"Show Password",requiredLblPost:"",optionalLblPost:"",dateLocale:"default",datePickerIcn:"fas fa-calendar",timePickerIcn:"fas fa-clock",timeScrollerUpIcn:"fas fa-chevron-up",timeScrollerDownIcn:"fas fa-chevron-down",checkListIcn:"fas fa-chevron-down",checkListDropUp:false,signOpts:["draw","type","stamp"],signMaxSize:640,signHeightPct:25,signFont:"sans-serif",signDrawTxt:"Draw",signTypeTxt:"Type",signStampTxt:"Accept",stampTxt:"Accept",stampBtnClass:"",stampBtnContext:"default",stampSetTxt:"Accepted",applyTtl:"Apply",resetTtl:"Reset",cancelTtl:"Cancel",drawIcn:"fas fa-signature",typeIcn:"fas fa-keyboard",stampIcn:"fas fa-check",applyIcn:"fas fa-check",resetIcn:"fas fa-eraser",cancelIcn:"fas fa-times",badgePosition:"left",currencySymbol:"$",negativeStyle:"default",selectionLayout:["icon","label"],selectionOnLabel:"",selectionOffLabel:"",selectionOnActive:"",selectionOffActive:"",selectionOnInactive:"dn",selectionOffInactive:"dn",checkIcn:"far fa-check-square",uncheckIcn:"far fa-square",toggleOnWrapper:"br-pill bg-light-blue",toggleOffWrapper:"br-pill bg-silver",toggleOnIcn:"br-100 bg-white",toggleOffIcn:"br-100 bg-white",radioOnIcn:"fas fa-circle-dot",radioOffIcn:"fas fa-circle",showPassIcn:"fas fa-fw fa-eye",hidePassIcn:"fas fa-fw fa-eye-slash",uploadIcn:"fas fa-file-upload",downloadIcn:"fas fa-file-download",deleteIcn:"fas fa-trash-alt",cameraIcn:"fas fa-camera",imageIcn:"fas fa-image",emailIcn:"fas fa-envelope",telIcn:"fas fa-phone",linkIcn:"fas fa-link",wordDocIcn:"fas fa-file-word",videoFileIcn:"fas fa-file-video",pdfFileIcn:"fas fa-file-pdf",musicFileIcn:"fas fa-file-audio",excelFileIcn:"fas fa-file-excel",fileIcn:"fas fa-file",codeFileIcn:"fas fa-file-code"};const S=I;function $(t){e.assign(I,t)}function O(e,t){return t&&e in t?t[e]:S[e]}const L={};function P(e,t){if(e in L){throw new Error(`Function ${e} already registered.`)}L[e]=t}function C(e){if(!(e in L)){throw new Error(`Function ${e} not registered.`)}return L[e]}function T(e,a){if(typeof e==="string"){return t("i",{class:h([a,e])})}else{return C(e.name)(e.data,a)}}function D(e){return(e+256).toString(16).substring(1)}function F(){const e=new Uint8Array(16);const t=window.crypto;t.getRandomValues(e);return[D(e[0]),D(e[1]),D(e[2]),D(e[3]),"-",D(e[4]),D(e[5]),"-",D(e[6]),D(e[7]),"-",D(e[8]),D(e[9]),"-",D(e[10]),D(e[11]),D(e[12]),D(e[13]),D(e[14]),D(e[15])].join("")}function q(){return Math.max(window.devicePixelRatio,1)}function B(e){return e&&(typeof e==="string"?e:e.text)}function E(e,t){const a=typeof e==="string"?e:e.text;const n=t?S.requiredLblPost:S.optionalLblPost;return n?a+n:a}function M({alt:e}){return e?t("span",{class:r.altLabel},e):null}function R(e,t){return t?t:e}function W(e,a,n,i){return t(a,n,[e.icon?T(e.icon,""):null,t("span",E(e,i)),M(e),e.rightIcon?T(e.rightIcon,""):null,e.href?t("a.link.dim.pointer.ws-normal.mh1",{onclick:e.onclick},[t("i",{class:S.linkIcn}),e.href]):null])}function _(e,a="mr2 truncate"){if(e){if(typeof e==="string"){return t("span",{title:e,class:h([a,r.displayLabel])},e)}else{return W(e,"span",{title:e.text,class:h([a,r.displayLabel])})}}return null}function A(e,a,n,i){if(n){if(typeof n==="string"){return t("label.mb1.db",{title:n,for:e,class:m(a,i)},E(n,i))}else{return W(n,"label.mb1.db",{title:n.text,for:e,class:m(a,i)},i)}}return null}function U(e){return[e.icon&&T(e.icon,"fa-fw"),e.text&&t("span",e.text),e.rightIcon&&T(e.rightIcon,"fa-fw")]}function N(e){return function({target:{value:t}}){e(t)}}function H(e,t){return t!=null?function({target:{checked:a}}){e(a?t:false)}:function({target:{checked:t}}){e(t)}}function z(e,t){if(e()!==t){e(t)}}function V({target:e}){e.select()}function j({key:e}){if(e==="Enter"&&document.activeElement){document.activeElement.click()}}function K(e){const t=e.lastIndexOf(".");if(t===-1){return[e,""]}else{return[e.substring(0,t),e.substring(t)]}}function Y(e){const[t,a]=e.split(",");const n=t.indexOf("base64")>=0?atob(a):unescape(a);const i=t.substring(t.indexOf("data:")+5).split(";");const s=i[0];const l=n.length;const r=new Uint8Array(l);for(let e=0;e<l;e++){r[e]=n.charCodeAt(e)}return new Blob([r],{type:s})}function Z(e,t){return new File([e],t,{type:e.type})}function G(e,t,a){const n=Z(Y(e),t);return{guid:F(),name:n.name,path:"not_set",file:n,dataUrl:e,metadata:a}}function J(e){const[,t]=K(e.name);switch(t.toLowerCase()){case".doc":case".docx":case".dot":case".wbk":case".docm":case".dotx":case".dotm":case".docb":case".txt":return S.wordDocIcn;case".webm":case".mkv":case".flv":case".vob":case".ogv":case".drc":case".gifv":case".mng":case".avi":case".mts":case".m2ts":case".mov":case".qt":case".wmv":case".yuv":case".rm":case".rmvb":case".viv":case".asf":case".amv":case".mp4":case".m4p":case".m4v":case".mpg":case".mp2":case".mpeg":case".mpe":case".mpv":case".m2v":case".svi":case".3gp":case".mxf":case".roq":case".nsv":case".f4v":case".f4p":case".f4a":case".f4b":return S.videoFileIcn;case".pdf":return S.pdfFileIcn;case".pcm":case".wav":case".aiff":case".mp3":case".aac":case".ogg":case".wma":case".flac":case".alac":return S.musicFileIcn;case".xls":case".xlt":case".xlm":case".xlsx":case".xlsm":case".xltx":case".xltm":case".xlsb":case".xla":case".xlam":case".xll":case".xlw":return S.excelFileIcn;case".html":case".js":case".css":case".scss":case".java":return S.codeFileIcn;case".jpg":case".jpeg":case".png":case".tiff":case".gif":case".svg":case".webp":return S.imageIcn;default:return S.fileIcn}}function Q(e){return e&&e.includes("image")}function X(e){const t=Math.min(e.byteLength,64*1024);const a=new DataView(e,0,t);if(a.getUint16(0,false)!==65496){return-2}const n=a.byteLength;let i=2;while(i<n){const e=a.getUint16(i,false);i+=2;if(e===65505){i+=2;if(a.getUint32(i,false)!==1165519206){return-1}i+=6;const e=a.getUint16(i,false)===18761;i+=a.getUint32(i+4,e);const t=a.getUint16(i,e);i+=2;for(let n=0;n<t;n++){if(a.getUint16(i+n*12,e)===274){return a.getUint16(i+n*12+8,e)}}}else if((e&65280)!==65280){break}else{i+=a.getUint16(i,false)}}return-1}function ee(e){return new Promise((t=>{const a=new FileReader;a.onload=()=>{t(a.result)};a.readAsArrayBuffer(e)}))}function te(e){return ee(e).then(X)}function ae(e,t,a,n){if(!n||n>8){return}switch(n){case 2:e.translate(t,0);e.scale(-1,1);return;case 3:e.translate(t,a);e.rotate(Math.PI);return;case 4:e.translate(0,a);e.scale(1,-1);return;case 5:e.rotate(.5*Math.PI);e.scale(1,-1);return;case 6:e.rotate(.5*Math.PI);e.translate(0,-a);return;case 7:e.rotate(.5*Math.PI);e.translate(t,-a);e.scale(-1,1);return;case 8:e.rotate(-.5*Math.PI);e.translate(-t,0);return}}function ne(e,t,a){if(e>t){if(e>a){return[a,Math.round(t*a/e)]}}else if(t>a){return[Math.round(e*a/t),a]}return[e,t]}function ie(e,t,a){if(!e.type.match(/image.*/)){return Promise.reject(new Error("File must be an image"))}return te(e).then((n=>new Promise((i=>{const s=new Image;s.onload=()=>{const e=document.createElement("canvas");const[l,r]=ne(s.width,s.height,t);if(n>4){e.width=r;e.height=l}else{e.width=l;e.height=r}const o=e.getContext("2d");ae(o,l,r,n);o.drawImage(s,0,0,l,r);i(e.toDataURL(a))};const l=new FileReader;l.onload=()=>s.src=l.result;l.readAsDataURL(e)}))))}function se(e,t){return new Promise((a=>{const n=new Image;n.onload=()=>{const e=document.createElement("canvas");const[i,s]=ne(n.width,n.height,t);e.width=i;e.height=s;const l=e.getContext("2d");l.drawImage(n,0,0,i,s);a(e.toDataURL())};n.src=e}))}function le(e,t,a,n){const i=document.createElement("canvas");i.width=t;i.height=a;const s=.56*i.height;const l=i.getContext("2d");l.textBaseline="middle";l.font=`${s}px ${n}`;l.fillText(e,i.height*.05,s);return i.toDataURL()}function re(e,t,a){const n=O("signMaxSize",a);const i=.01*t*n;return le(e,n,i,O("signFont",a))}class oe{static format(e,t=false,a=false){const n=this.numtoStr(e,true);const i=a?e>0:e<0;if(n&&i){return t?`(${n})`:`-${n}`}else{return n}}static strToNum(t){const a=t.replace("(-","-").replace("(","-").replace(")","").replace(/[^\d.-]/g,"");let n;let i=0;if(a.indexOf(".")>-1){const t=a.indexOf(".");const s=a.substring(0,t);n=e.parseInt(e.padStart(s,1,"0"));const l=a.substring(t+1,Math.min(t+3,a.length));i=e.parseInt(e.padEnd(l,2,"0"))}else{n=e.parseInt(a)||0}return n<0?n*100-i:n*100+i}static numtoStr(t,a){const n=this.numToTuple(t);if(n){const t=a?this.formatter.format(n[0]):n[0];const i=e.padStart(String(n[1]),2,"0");return`${t}.${i}`}else{return undefined}}static numToTuple(t){if(!e.isFinite(t)){return undefined}const a=Math.abs(t);let n=0;let i;if(a>99){n=Math.trunc(a/100);i=a%100}else{i=a}return[n,i]}}oe.formatter=new Intl.NumberFormat;class ce{view({attrs:{label:e,classes:a="bg-red"},children:n}){return t(".relative.dib",[n,e?t("span.absolute.minw-65rem.ph1.nt1.nr1.top-0.right-0.br-pill.tc.f5.white.o-80",{class:a},e):null])}}class de{view({attrs:{label:e="",type:a="button",title:n=e,icon:i,rightIcon:s,context:l,classes:o="",style:c,disabled:d,onclick:h,tabindex:p}}){return t("button.button-reset",{type:a,title:n,disabled:d,class:`${o} ${d?r.disabledWrapper:"pointer"} ${u(l)} ${r.button}`,style:c,tabindex:p,onclick:h},U({text:e,icon:i,rightIcon:s}))}}class ue{view({attrs:{label:e="",title:a=e,icon:n,rightIcon:i,href:s,rel:l,target:o,download:c,context:d,classes:h="",style:p}}){return t("a.link.flex.items-center",{href:s,rel:l,target:o,download:c,title:a,class:`${h} ${u(d)} ${r.button}`,style:p},U({text:e,icon:n,rightIcon:i}))}}class he{view({attrs:{label:e="",title:a=e,icon:n,rightIcon:i,classes:s="",style:l,disabled:o,onclick:c}}){return t(".mh2.pa2.truncate",{title:a,disabled:o,class:`${s} ${o?r.disabledWrapper:"pointer"} ${r.navButton}`,style:l,onclick:c},U({text:e,icon:n,rightIcon:i}))}}class pe{view({attrs:{label:e="",title:a=e,icon:n,rightIcon:i,href:s,rel:l,target:o,download:c,classes:d="",style:u}}){return t("a.link.mh2.pa2.truncate",{href:s,rel:l,target:o,download:c,title:a,class:`${d} ${r.navButton}`,style:u},U({text:e,icon:n,rightIcon:i}))}}function fe(e){switch(e){case"left":return{left:"initial",top:"initial",right:"calc(100% + 0.25rem)",bottom:"initial"};case"top":return{left:"initial",top:"initial",right:"initial",bottom:"calc(100% + 0.25rem)"};case"topRight":return{left:"calc(100%)",top:"initial",right:"initial",bottom:"calc(100%)"};case"topLeft":return{left:"initial",top:"initial",right:"calc(100%)",bottom:"calc(100%)"};case"bottom":return{left:"initial",top:"calc(100% + 0.25rem)",right:"initial",bottom:"initial"};case"bottomRight":return{left:"calc(100%)",top:"calc(100%)",right:"initial",bottom:"initial"};case"bottomLeft":return{left:"initial",top:"calc(100%)",right:"calc(100%)",bottom:"initial"};default:return{left:"calc(100% + 0.25rem)",top:"initial",right:"initial",bottom:"initial"}}}class me{constructor(){this.show=false}view({attrs:{message:e,direction:a="right",icon:n=S.tooltipIcon}}){return t("div",{class:r.tooltipWrapper},[t(".flex.items-center.justify-center",{class:r.tooltipIconBackground,onmouseenter:()=>this.show=true,onmouseleave:()=>this.show=false},[t("i",{class:h([n,r.tooltipIcon])}),this.show&&t("div",{class:r.tooltipMessage,style:fe(a)},e.map((e=>t("p.mv2",e))))])])}}class ge{view({attrs:{value:e}}){return t(".pa2",{},t.trust(e()))}}class be{view({attrs:{field:e,value:a}}){const{label:n,uiClass:i={}}=e;return t(".pa2.flex.flex-wrap",{class:f(i)},[_(n),t("span.ws-normal",{title:a(),class:r.displayValue},a())])}}class ve{formatter(e){return e?new Date(String(e)).toLocaleDateString():e}oninit({attrs:{value:e}}){this.formatted=e.map(this.formatter)}onremove(){this.formatted.end(true)}view({attrs:{field:e}}){return t(be,{field:e,value:this.formatted})}}function ye(e,t){if(e==="email"){return{href:`mailto:${t}`,class:r.displayValue}}else if(e==="tel"){return{href:`tel:${t}`,class:r.displayValue}}else{return{href:t,target:"_blank",class:r.displayValue}}}const xe={email:S.emailIcn,tel:S.telIcn};function we(e,t){if(e==="email"){return O("emailIcn",t)}else if(e==="tel"){return O("telIcn",t)}else{return O("linkIcn",t)}}class ke{view({attrs:{field:e,value:a}}){const{label:n,type:i="url",uiClass:s={},config:l}=e;return t(".pa2.flex.flex-wrap",{class:f(s)},[_(n),t("a.link.dim.pointer.ws-normal",ye(i,a()),t("i.mr2",{class:we(i,l)}),a())])}}class Ie{view({attrs:{selected:e,label:a,onIcon:n,offIcon:i,config:s}}){return t(".flex.items-center.h-100",O("selectionLayout",s).map((l=>{switch(l){case"label":return a;case"icon":return T(e?n:i,"mh1");case"on":return t("span.mh1",{class:O(e?"selectionOnActive":"selectionOnInactive",s)},O("selectionOnLabel",s));case"off":return t("span.mh1",{class:O(e?"selectionOffInactive":"selectionOffActive",s)},O("selectionOffLabel",s))}})))}}class Se{constructor(){this.onIcon="checkIcn";this.offIcon="uncheckIcn"}view({attrs:{field:e,value:a}}){const{label:n,uiClass:i={},config:s}=e;return t(".pa2",{class:f(i)},t(Ie,{selected:Boolean(a()),label:_(n,"mh1 truncate"),onIcon:O(this.onIcon,s),offIcon:O(this.offIcon,s),config:s}))}}class $e extends Se{constructor(){super(...arguments);this.onIcon="toggleOnIcn";this.offIcon="toggleOffIcn"}}function Oe(e,t){if(e.required){return t.length<1}return false}function Le(e){return t=>{t.preventDefault();if(t.dataTransfer){t.dataTransfer.dropEffect="copy"}if(e()){t.redraw=false}e(true)}}function Pe(e){return t=>{t.preventDefault();e(false)}}function Ce(e,t){return a=>{a.preventDefault();e(false);if(a.dataTransfer){t(a.dataTransfer.files)}}}function Te(e){return({target:{files:t}})=>e(t)}class De{constructor(){this.showLabel=true}oncreate({dom:e,attrs:{value:t}}){t.map((t=>{if(t.length===0){e.firstChild.value=""}}))}view({attrs:{field:e,defaultAccept:a="*",multiple:n=true,dragging:i,onSet:s},children:l}){const{label:r,id:o,name:c=o,title:d=B(r),required:u,readonly:h,disabled:p,autofocus:f,tabindex:m="0",accept:g=a,uiClass:b={}}=e;const v=this.showLabel&&r?A(o,b,r,u):null;return t("label.db",Object.assign({for:o,title:d,class:k(p,h),tabindex:m,"aria-labelled-by":o,"data-input-id":o,onkeydown:e=>{var t;if(e.key===" "){((t=document.activeElement)===null||t===void 0?void 0:t.firstElementChild).click()}}},p||h?{}:{ondragover:Le(i),ondragleave:Pe(i),ondrop:Ce(i,s)}),[t("input.clip[type=file].bg-transparent.bn.outline-0",{id:o,name:c,multiple:n,accept:g,required:u,autofocus:f,disabled:p||h,tabindex:-1,onchange:Te(s)}),v,l])}}function Fe(t,a=false){return n=>{const i=a?[]:t();e.each(n,(e=>{i.push({guid:F(),name:e.name,path:"not_set",file:e})}));t(i)}}function qe(t,a){return n=>{n.preventDefault();const i=t();e.remove(i,{guid:a});t(i)}}class Be{constructor(){this.dragging=a(false)}view({attrs:{field:a,value:n}}){const{disabled:i,uiClass:s={},config:l,readonly:r}=a;return t("div",{class:f(s,i)},[t(De,{field:a,dragging:this.dragging,onSet:Fe(n),value:n},t(".pa2",{class:w(s,this.dragging(),Oe(a,n()))},[T(O("uploadIcn",l),"db mr2"),t("span",O("addFilesTxt",l))])),t(".flex.flex-column.mt1.nb1",e.map(n(),(e=>t("span.pa2.mv1.ba.b--black-20.hide-child.dim.pointer",[T(O("downloadIcn",l),"db mr2"),e.name,!(r||i)&&t("i.child.fr",{title:`${O("remFileTtl",l)} ${e.name}`,onclick:qe(n,e.guid)},T(O("deleteIcn",l),"db"))]))))])}}class Ee{view({children:e,attrs:a}){return t(".relative.w-third.w-25-m.w-20-l.pa1.tc.hide-child",{tabindex:0,onkeydown:({key:e})=>{var t;if(e==="Enter"&&document.activeElement){(t=document.activeElement.querySelector("button"))===null||t===void 0?void 0:t.click()}}},[a.src&&a.src!=="not_set"?t("img.contain",{src:a.src}):null,a.data&&a.data.file&&(a.src==="not_set"||!a.src)?t("div.contain.tc.br5.6rem",{class:`${J(a.data)} fa-2x`,tooltip:a.data.file.type}):null,e])}}class Me{view({attrs:e}){return t("i.pa1",{class:J(e),title:S.openFileTxt,onclick:e.path!=="not_set"?()=>window.open(e.path,"_blank"):undefined})}}class Re{view({attrs:{displayType:a="thumbnail",value:n,readonlyOrDisabled:i,config:s}}){return a==="thumbnail"?t(".flex.flex-row.flex-wrap.mt1.nr1.nb1.nl1.max-h-thumb",e.map(n(),(e=>t(Ee,{src:R(e.path,e.dataUrl),data:e},!i&&t(".absolute.top-0.right-0.child",t(de,{title:`Remove ${e.name}`,icon:O("deleteIcn",s),onclick:qe(n,e.guid),tabindex:-1})))))):t(".pa2.flex.flex-column",e.map(n(),(e=>t(".flex.items-center.pa1.ba.b--black-20",[T(O("uploadIcn",s),"pa1"),t("span.ma1.flex-auto",{title:e.name},e.name),t(Me,e),!i&&t("i.pa1.pointer.dim",{title:`Remove ${e.name}`,class:O("cancelIcn",s),onclick:qe(n,e.guid)})]))))}}class We{view({attrs:{field:a,value:n}}){const{label:i,options:s,uiClass:l={}}=a;const o=e.find(s,{value:n()});const c=o?o.label||o.value:n();return t(".pa2.flex.flex-wrap",{class:f(l)},[_(i),t("span.ws-normal",{title:c,class:r.displayValue},c)])}}class _e{view({attrs:{field:a,value:n}}){const{label:i,uiClass:s={},config:l}=a;return t(".pa2.flex.flex-column",{class:f(s)},[_(i),t(".flex.flex-column.mt1.nb1",e.map(n(),(({name:e,path:a})=>t("a.pa2.mv1.link.ba.b--black-20.dim.dib.pointer[target=_blank]",{class:r.displayValue,href:a},[T(O("downloadIcn",l),"db mr2"),e]))))])}}class Ae{view({attrs:{field:a,value:n}}){const{label:i,uiClass:s={}}=a;return t(".pa2.flex.flex-column",{class:f(s)},[_(i),t(".flex.flex-row.flex-wrap.mt1.nr1.nb1.nl1.max-h-thumb",e.map(n(),(({name:e,path:a,dataUrl:n})=>t(Ee,{title:e,src:R(a,n)}))))])}}class Ue{view({attrs:{field:a,value:n}}){const{label:i,uiClass:s={},config:l}=a;const o=e.head(n());return t(".pa2.flex.flex-column",{class:f(s)},[_(i),o?t("img.img.h-100.max-h-img.mt2.contain.self-center",{title:o.name,src:R(o.path,o.dataUrl)}):t("i.mt2",{class:`${r.displayValue} ${O("imageIcn",l)}`})])}}function Ne(e,t){return(e.match(t)||[]).length}function He(e){let t=0;if(e.length>=8){t=1;if(e.length>=24){t=t+1}if(Ne(e,/[A-Z]/g)>1&&Ne(e,/[a-z]/g)>2){t=t+1}if(Ne(e,/\d/g)>1){t=t+1}if(Ne(e,/[!"Â£%^@#$&*]/g)>0){t=t+1}}return t}function ze(e){switch(e){case 0:{return"Invalid"}case 1:{return"Very Weak"}case 2:{return"Weak"}case 3:{return"Average"}case 4:{return"Strong"}case 5:{return"Very Strong"}}return""}const Ve=[{value:1,background:"bg-dark-red"},{value:2,background:"bg-orange"},{value:3,background:"bg-yellow"},{value:4,background:"bg-light-green"},{value:5,background:"bg-green"}];class je{oninit({attrs:{value:e}}){this.passwordScore=e.map((e=>He(String(e))))}onremove(){this.passwordScore.end()}view({attrs:{field:a}}){const{label:n}=a;return t(".flex.flex-column",[_(n),t(".flex.mt1",e.map(Ve,(e=>t(".h1.w-20",{class:this.passwordScore()>=e.value?e.background:"bg-transparent"})))),t("span.f5.truncate",ze(this.passwordScore()))])}}class Ke{view({attrs:{field:{label:e="",id:a,required:n,uiClass:i={}}}}){return t("div",{class:f(i)},A(a,i,e,n))}}class Ye{constructor(){this._focus=false;this._touch=true;this._valid=true;this.touch=this.unboundTouch.bind(this);this.boundFocus=this.unboundFocus.bind(this);this.selector="input"}unboundTouch(){this._touch=true;this._focus=false;t.redraw()}unboundFocus(){this._focus=true;t.redraw()}get inFocus(){return this._focus}get invalid(){return!this._valid}checkValidity(){if(this._touch){const e=this._inputElement.checkValidity();if(e!==this._valid){this._valid=e;t.redraw()}}}oncreate({dom:e,attrs:{value:t}}){e.addEventListener("focusin",this.boundFocus);e.addEventListener("focusout",this.touch);this._inputElement=e.querySelector(this.selector);if(t()!=null){this._touch=true}this.checkValidity()}onupdate({attrs:{value:e}}){if(e()!=null&&this._touch===false){this.touch()}this.checkValidity()}onbeforeremove({dom:e}){e.removeEventListener("focusin",this.boundFocus);e.removeEventListener("focusout",this.touch)}}class Ze{view({attrs:e,children:a}){const{field:n,invalid:i,focus:s}=e;const{label:l,id:r,type:o="text",required:c,disabled:d,uiClass:u={}}=n;return t("div",{class:o==="hidden"?"clip":f(u,d)},[A(r,u,l,c),t("fieldset",{class:b(n,i,s)},a)])}}class Ge{shouldFloat(e,t,a,n=false){return e==="floatAlways"||a||Boolean(t)||n}labelTranslateY(){return"calc(50% + 0.175ch - 1.5ex)"}labelContent(e,t){return typeof e==="string"?E(e,t):[E(e,t),M(e)]}view({attrs:e,children:a}){const{field:n,value:i,xform:s=i,invalid:l,focus:r}=e;const{label:o,id:c,type:d="text",placeholder:u,required:p,disabled:v,readonly:y,uiClass:x={},config:w,layout:k=O("layoutType",w)}=n;const I=this.shouldFloat(k,u||s()!=null&&String(s()),r,y);return t("div",{class:h([d==="hidden"?"clip":f(x,v),o?"pt2":null])},t("fieldset.relative.pa0.ma0.w-100",{class:b(n,l,r)},[o?[t("legend.db.hidden.h-05ch.transition-mw",{class:`${m(x,p)} ${I?"mw-100":"mw-001px"}`},t("span.f-07em",this.labelContent(o,p))),t(".absolute.h-100.top-0.transition-transform.pe-none",{style:{transform:`translateY(${I?"-1ch":this.labelTranslateY()})`}},t("label.db.transition-f",{for:c,title:typeof o==="string"?o:o.text,class:g(n,I)},this.labelContent(o,p)))]:null,a]))}}class Je{constructor(){this.layout=Ge}view({attrs:e,children:a}){const{field:{config:n,layout:i=O("layoutType",n)}}=e;return t(i==="default"?Ze:this.layout,e,a)}}class Qe extends Ge{shouldFloat(){return true}}class Xe extends Je{constructor(){super(...arguments);this.layout=Qe}}const et=new Set(["date","datetime-local","time","color","range"]);class tt extends Ye{view({attrs:e}){const{field:a,value:n,xform:i=n}=e;const{label:s,id:l,type:r="text",name:o=l,title:c=B(s),placeholder:d,max:u,maxlength:h,min:p,minlength:f,step:m,required:g,readonly:b,disabled:y,autofocus:x,autocomplete:w,tabindex:k,pattern:I,inputmode:S,spellcheck:$,instant:O,uiClass:L={}}=a;const P=et.has(r)?Xe:Je;return t(P,{field:a,value:n,xform:i,invalid:this.invalid,focus:this.inFocus},t("input.w-100.bg-transparent.bn.outline-0",{id:l,type:r,name:o,title:c,placeholder:d,max:u,maxlength:h,min:p,minlength:f,step:m,required:g,readonly:b,disabled:y,autofocus:x,autocomplete:w,tabindex:k,pattern:I,inputmode:S,spellcheck:$,class:v(L),value:i(),[O?"oninput":"onchange"]:N(n)}))}}class at extends Ye{view({attrs:a}){const{field:n,value:i,xform:s=i}=a;const{label:l,id:o,name:c=o,title:d=B(l),placeholder:u,max:p,maxlength:f,min:m,minlength:g,step:b,required:y,readonly:x,disabled:w,autofocus:k,autocomplete:I,tabindex:S,pattern:$,inputmode:L,spellcheck:P,uiClass:C={},config:T}=n;const D=O("currencySymbol",T);const F=O("negativeStyle",T);const q=O("badgePosition",T);const E=nt(s());const M=v(C);const R=E<0;const W=F==="red";const _=W||F==="redParentheses";const A=F==="parentheses"||F==="redParentheses";return t(Xe,{field:n,value:i,invalid:this.invalid,focus:this.inFocus},t(".flex.w-100",[t("span.self-center",{class:h([q==="left"?"order-0 mr1":"order-last ml1",M])},D),t("input.absolute.pa0.w1.o-0.pe-none[type=number]",{name:c,value:E,max:p,maxlength:f,min:m,minlength:g,step:b,required:y,readonly:x,disabled:w,tabindex:-1,ariaHidden:"true"}),t("input.w-100.bg-transparent.bn.outline-0",{id:o,type:"text",name:`${c}-currency`,title:d,placeholder:u,required:y,readonly:x,disabled:w,autofocus:k,autocomplete:I,tabindex:S,pattern:$,inputmode:L,spellcheck:P,class:h([q==="right"?"tr":"",_&&R?r.redNumber:null,M]),onfocus:V,onblur:this.touch,value:e.isUndefined(s())?null:oe.format(E,A,W&&R),onchange:it(i)})]))}}function nt(t){return e.isString(t)?e.parseInt(t):Number(t)}function it(e){return({target:{value:t}})=>e(oe.strToNum(t))}function st(e,t,a=false){const n=rt(e);const i=a?e>0:e<0;if(i){if(t.toLowerCase().includes("parentheses")){return`(${n})`}else if(t!=="red"){return`-${n}`}}return n}function lt(e){return oe.strToNum(e)}function rt(e){const t=ot(e);if(t){return`${t[0]}.${t[1]}`}else{return t}}function ot(t){if(!e.isFinite(t)){return undefined}const a=String(Math.abs(t));let n="0";let i="";if(a.length>2){const e=a.length-2;n=a.substring(0,e);i=a.substring(e)}else{i=e.padStart(a,2,"0")}return[n,i]}class ct extends Ye{view({attrs:e}){const{field:a,value:n,xform:i=n}=e;const{label:s,id:l,name:r=l,title:o=B(s),placeholder:c,max:d,maxlength:u,min:p,minlength:f,step:m,required:g,readonly:b,disabled:y,autofocus:x,autocomplete:w,tabindex:k,pattern:I,inputmode:S,spellcheck:$,instant:L,uiClass:P={},config:C}=a;const T=O("badgePosition",C);return t(Xe,{field:a,value:n,invalid:this.invalid,focus:this.inFocus},t(".flex.flex-row.w-100",[t("span.self-center",{class:h([T==="left"?"order-0 mr1":"order-last ml1",v(P)])},"%"),t("input.w-100.bg-transparent.bn.outline-0",{id:l,type:"number",name:r,title:o,placeholder:c,max:d,maxlength:u,min:p,minlength:f,step:m,required:g,readonly:b,disabled:y,autofocus:x,autocomplete:w,tabindex:k,pattern:I,inputmode:S,spellcheck:$,class:h([T==="right"?"tr":"",v(P)]),onfocus:V,value:i(),[L?"oninput":"onchange"]:N(n)})]))}}function dt(e){switch(e){case"day":return"dd";case"month":return"mm";case"year":return"yyyy"}}function ut(e,t,a){const n=e.querySelector(`#${t}-${a}`);n.focus()}function ht(e){const t=e?e.toLocaleLowerCase():"";if(t.includes("month")){return"mm"}else if(t.includes("day")){return"dd"}else if(t.includes("year")){return"yy"}else{return null}}function pt(e,t,a){const n=e.querySelector(`#${t}-${a}`);n.focus();n.select()}function ft(e){return parseInt(e.getAttribute("maxlength"))}function mt(e,t,a,n,i,s,{next:l,prev:r}){const o=n.querySelector(`#${e}-${t}`);const c=ft(o);if((i.key==="Backspace"||i.key==="Delete")&&a.length===0&&r){pt(n,e,r);i.preventDefault()}else if(s.charCodeAt(0)===i.key.charCodeAt(0)&&l&&a.length!==0&&a.length<c){pt(n,e,l);i.preventDefault()}}function gt(e,t,a,n,i,s){if(vt(a,n,i)&&e){s(t)}else{s("")}}function bt(e){const t=String(e());if(t.length===1&&t!=="0"){e(`0${t}`)}}function vt(e,t,a){const n=!a?2:4;return e.length===n&&t.length===2&&(!a||a.length===2)}function yt(e){if(e.includes("month")){return"month"}else if(e.includes("day")){return"day"}return"date"}function xt(e,t,a){if(e.invalidExplanation){if(a){return""}else{return`Please check the ${yt(e.invalidExplanation)}.`}}else if(!e.year||Number(t)<1900){return"Year must be greater than 1900."}return""}function wt(e,t,a){if(!a){if(!t&&!e){return""}else if(t.length!==2||Number(t)>12){return`Please check the month.`}else if(e.length!==2){return`Please check the year.`}}return""}function kt(e,t){if(t){const a=ht(e);t.querySelectorAll("input").forEach((t=>{if(a&&t.id.substring(t.id.length-2)===a&&e){t.setCustomValidity(e)}else{t.setCustomValidity("")}}))}}function It(e,t,a,n){const i=t.length===2&&e.length===2&&Number(t)<=12&&Number(t)>0||!e&&!t&&!a;kt(wt(e,t,i),n);return i}function St(e,t,a,i,s){const l=n.fromObject({year:Number(e),month:Number(t),day:Number(a)});const r=!e&&!t&&!a;kt(xt(l,e,r),s);const o=Number(e)>=1900;const c=i.min?l>=n.fromISO(String(i.min)):true;const d=i.max?l<=n.fromISO(String(i.max)):true;return l.isValid&&c&&d&&o||r&&!i.required}function $t(e,t,a,n,i){const s=n.querySelector(`#${t}-${a}`);const l=e()||"";const r=s.value;const o=/^\d*$/.test(r);if((o||r==="")&&r.length<=4){e(r)}else{e(l)}if(String(e()).length===ft(s)&&i){pt(n,t,i)}}class Ot{constructor(){this.dom=a();this.valid=a();this.focusedInput=a("mm");this.month=a("");this.year=a("");this.date=a("")}buildDate(e,t){this.date(`${this.month()}/${this.year()}`);const a=It(this.year(),this.month(),e,this.dom());gt(a,this.date(),this.year(),this.month(),"",t)}oninit({attrs:{value:e,field:t}}){this.valid(!t.required);e.map((e=>{if(e){this.date("");const[t,a]=String(e).split("/");this.month(t);this.year(a)}else if(!this.date()){this.month("");this.year("")}this.valid(It(this.year(),this.month(),Boolean(t.required),this.dom()))}))}oncreate({dom:e}){z(this.dom,e)}onupdate({dom:e}){z(this.dom,e)}onremove(){this.date.end(true);this.year.end(true);this.month.end(true)}view({attrs:a}){const{field:n,value:i}=a;const{id:s,name:l=s,required:r,readonly:o,disabled:c,tabindex:d,uiClass:u={}}=n;const h=v(u);return t(Xe,{field:n,value:i,invalid:!this.valid(),focus:false},t(".flex.ph-2px.pv-1px",{onclick:()=>ut(this.dom(),s,this.focusedInput())},t("span",[t("input.w-100.mw-mm.pa0.bg-transparent.bn.outline-0.tc",{id:`${s}-mm`,name:`${l}-mm`,type:"text",placeholder:"MM",minlength:"2",maxlength:"2",pattern:"[0-9]*",inputmode:"numeric",required:r,readonly:o,disabled:c,tabindex:d,"aria-label":`${l}: Month`,value:this.month(),class:h,onfocus:e.partial(this.focusedInput,"mm"),oninput:()=>{$t(this.month,s,"mm",this.dom(),"yy");this.buildDate(Boolean(n.required),a.value)},onkeydown:e=>{mt(s,"mm",this.month(),this.dom(),e,"/",{next:"yy"})},onblur:()=>{bt(this.month);this.buildDate(Boolean(n.required),a.value)}})]),t("span.pa0.mr-2px","/"),t("span",[t("input.w-100.mw-yy.pa0.bg-transparent.bn.outline-0.tc",{id:`${s}-yy`,name:`${l}-yy`,type:"text",placeholder:"YY",minlength:"2",maxlength:"2",pattern:"[0-9]*",inputmode:"numeric",required:r,readonly:o,disabled:c,tabindex:d,"aria-label":`${l}: Year`,value:this.year(),class:h,onfocus:e.partial(this.focusedInput,"yy"),onkeydown:e=>{mt(s,"yy",this.year(),this.dom(),e,"/",{prev:"mm"})},oninput:()=>{$t(this.year,s,"yy",this.dom());this.buildDate(Boolean(n.required),a.value)}}),t("input.dn",{id:s,required:r,readonly:o,disabled:c,tabindex:-1,ariaHidden:"true"})])))}}function Lt(t){return[String(t.getFullYear()),e.padStart(String(1+t.getMonth()),2,"0"),e.padStart(String(t.getDate()),2,"0")]}class Pt{oncreate({dom:e,attrs:{field:{max:a,min:n},value:s}}){const l=e.parentElement;const{left:r,right:o}=l.getBoundingClientRect();this.flatpickr=i(e,{positionElement:l,position:r+o<window.innerWidth?"below left":"below right",disableMobile:true,minDate:n,maxDate:a,onChange:([e])=>{if(e){s(Lt(e).join("-"));t.redraw()}}});this.valueChange=s.map((e=>{const t=new Date(String(e));if(isNaN(t.valueOf())){this.flatpickr.clear()}else{this.flatpickr.setDate(t,false)}}))}onremove(){this.flatpickr.destroy();this.valueChange.end(true)}view({attrs:{field:{config:e}}}){return T(O("datePickerIcn",e),"ph-2px pv-1px")}}class Ct{constructor(){this.dom=a();this.valid=a();this.focusedInput=a(undefined);this.locale=a(undefined);this.literalKey=a("/");this.day=a("");this.month=a("");this.year=a("");this.date=a()}buildDate(e,t){this.date(`${this.year()}-${this.month()}-${this.day()}`);const a=St(this.year(),this.month(),this.day(),t,this.dom());gt(a,this.date(),this.year(),this.month(),this.day(),e)}findNextInput(e){const t=this.dateInputAdvanceOrder.indexOf(e);return t!==this.dateInputAdvanceOrder.length&&dt(this.dateInputAdvanceOrder[this.dateInputAdvanceOrder.indexOf(e)+1])}findPrevInput(e){const t=this.dateInputAdvanceOrder.indexOf(e);return t!==0&&dt(this.dateInputAdvanceOrder[this.dateInputAdvanceOrder.indexOf(e)-1])}setDateInputs(t){const a=new Intl.DateTimeFormat(t).formatToParts();this.dateParts=a;const n=a[0].type;this.literalKey(a[1].value);const i=dt(n);this.focusedInput(i);this.dateInputAdvanceOrder=e(this.dateParts).map((({type:e})=>e)).filter((e=>e!=="literal")).value()}setLocale(e){const t=O("dateLocale",e);if(t!==this.locale()){this.locale(t)}}createDateInputs({type:a,value:n},{attrs:{field:i,value:s}}){const{id:l,name:r=l,required:o,readonly:c,disabled:d,tabindex:u,uiClass:h={}}=i;const p=v(h);switch(a){case"literal":return t("span.pa0.mr-2px",n);case"day":return t("span",t("input.w-100.mw-dd.pa0.bg-transparent.bn.outline-0.tc",{id:`${l}-dd`,name:`${r}-dd`,type:"text",placeholder:"DD",minlength:"2",maxlength:"2",pattern:"[0-9]*",inputmode:"numeric",required:o,readonly:c,disabled:d,tabindex:u,value:this.day(),"aria-label":`${r}: Day`,class:`${p} maxw-dd p-0px`,onfocus:e.partial(this.focusedInput,"dd"),onkeydown:e=>{mt(l,"dd",this.day(),this.dom(),e,this.literalKey(),{next:this.findNextInput("day"),prev:this.findPrevInput("day")})},oninput:()=>{$t(this.day,l,"dd",this.dom(),this.findNextInput("day"));this.buildDate(s,i)},onblur:()=>{bt(this.day);this.buildDate(s,i)}}));case"month":return t("span",t("input.w-100.mw-mm.pa0.bg-transparent.bn.outline-0.tc",{id:`${l}-mm`,name:`${r}-mm`,type:"text",placeholder:"MM",minlength:"2",maxlength:"2",pattern:"[0-9]*",inputmode:"numeric",required:o,readonly:c,disabled:d,tabindex:u,value:this.month(),"aria-label":`${r}: Month`,class:`${p} maxw-mm p-0px`,onkeydown:e=>{mt(l,"mm",this.month(),this.dom(),e,this.literalKey(),{next:this.findNextInput("month"),prev:this.findPrevInput("month")})},oninput:()=>{$t(this.month,l,"mm",this.dom(),this.findNextInput("month"));this.buildDate(s,i)},onfocus:e.partial(this.focusedInput,"mm"),onblur:()=>{bt(this.month);this.buildDate(s,i)}}));case"year":return t("span",t("input.w-100.mw-yyyy.pa0.bg-transparent.bn.outline-0.tc",{id:`${l}-yyyy`,name:`${r}-yyyy`,type:"text",placeholder:"YYYY",minlength:"4",maxlength:"4",pattern:"[0-9]*",inputmode:"numeric",required:o,readonly:c,disabled:d,tabindex:u,value:this.year(),"aria-label":`${r}: Year`,class:`${p} maxw-yyyy p-0px`,onfocus:e.partial(this.focusedInput,"yyyy"),onkeydown:e=>{mt(l,"yyyy",this.year(),this.dom(),e,this.literalKey(),{next:this.findNextInput("year"),prev:this.findPrevInput("year")})},oninput:()=>{$t(this.year,l,"yyyy",this.dom(),this.findNextInput("year"));this.buildDate(s,i)}}))}}resetDateParts(){this.day("");this.month("");this.year("")}oninit({attrs:{value:e,field:t}}){const{required:a,config:n}=t;this.valid(!a);this.valueChange=e.map((e=>{if(e){const t=new Date(String(e));this.date("");if(isNaN(t.valueOf())){this.resetDateParts()}else{const[e,a,n]=Lt(t);this.day(n);this.month(a);this.year(e)}}else if(!this.date()){this.resetDateParts()}this.valid(St(this.year(),this.month(),this.day(),t,this.dom()))}));this.locale.map((e=>{this.setDateInputs(e)}));this.setLocale(n)}oncreate({dom:e}){z(this.dom,e)}onbeforeupdate({attrs:{field:e}}){this.setLocale(e.config);this.valid(St(this.year(),this.month(),this.day(),e,this.dom()))}onupdate({dom:e}){z(this.dom,e)}onremove(){this.valueChange.end(true);this.date.end(true);this.year.end(true);this.month.end(true);this.day.end(true);this.locale.end(true)}view(e){const{attrs:{field:a,value:n}}=e;const{id:i,required:s,readonly:l,disabled:r,min:o,max:c}=a;return t(Xe,{field:a,value:n,invalid:!this.valid(),focus:false},t(".flex.items-center",[t(".flex-auto.ph-2px.pv-1px",{onclick:()=>ut(this.dom(),i,this.focusedInput())},this.dateParts.map((t=>this.createDateInputs(t,e))),t("input.dn",{id:i,required:s,readonly:l,disabled:r,min:o,max:c,tabindex:-1,ariaHidden:"true"})),!(r||l)&&t(Pt,{field:a,value:n})]))}}class Tt{static formatValue(e){const t=e();return t!=null?t.padStart(2,"0").slice(0,2):"-"}static applyStep(e,t,a,n){const i=Number(Tt.formatValue(e));const s=isNaN(i)?a:i;const l=s+t;const r=l<a||l>n?s:l;e(r.toString())}view({attrs:{value:e,step:a=1,min:n,max:i,config:s}}){return t(".flex.flex-column.items-center",[t(".pointer",{onclick:()=>Tt.applyStep(e,a,n,i)},T(O("timeScrollerUpIcn",s),"")),t("span.mv2.w-100.mw-dd.tc.f6.fw6",{class:r.timeInputScrollerNumber},Tt.formatValue(e)),t(".pointer",{onclick:()=>Tt.applyStep(e,-a,n,i)},T(O("timeScrollerDownIcn",s),""))])}}class Dt{oncreate({dom:e,attrs:{onClose:a}}){this.dom=e;this.clickListener=e=>{if(e.target&&!this.dom.contains(e.target)){a();t.redraw()}};document.addEventListener("click",this.clickListener)}onremove(){document.removeEventListener("click",this.clickListener)}view({attrs:{hour:e,min:a,step:n,config:i}}){return t(".flex.items-center.absolute.z-max.us-none",{class:r.timeInputScrollerWrapper},[t(Tt,{value:e,min:0,max:23,config:i}),t("span.ph2.f6",":"),t(Tt,{value:a,min:0,max:59,step:n,config:i})])}}function Ft(e){return e.replace(/[^0-9]/g,"").slice(0,2)}function qt(e){return e.padStart(2,"0")}class Bt extends Ye{constructor(){super(...arguments);this.showPicker=false;this.focus=0;this.hour=a();this.cleanHour=this.hour.map(Ft);this.padHour=this.cleanHour.map(qt);this.min=a();this.cleanMin=this.min.map(Ft);this.padMin=this.cleanMin.map(qt);this.time=a.lift(((e,t)=>e&&t?`${e}:${t}`:""),this.padHour,this.padMin)}syncTime(e){const t=e();if(t!==this.time()){const[e,a=""]=String(t).split(":");this.hour(e);this.min(a)}}oninit({attrs:{value:e}}){this.time.map((t=>e(t)));this.syncTime(e)}onbeforeupdate({attrs:{value:e}}){this.syncTime(e)}onremove(){this.time.end(true);this.min.end(true);this.hour.end(true)}view({attrs:e}){const{field:a,value:n}=e;const{id:i,name:s=i,step:l,required:r,readonly:o,disabled:c,uiClass:d={},config:u}=a;const h=v(d);return t(Xe,{field:a,value:n,invalid:this.invalid,focus:this.inFocus},t(".flex.items-center",[t(".relative.flex-auto.ph-2px.pv-1px",{},[t("input.absolute.pa0.w1.o-0.pe-none[type=text]",{name:s,value:n(),required:r,readonly:o,disabled:c,tabindex:-1,ariaHidden:"true"}),t("input.di.w-100.mw-tt.pa0.bg-transparent.bn.outline-0.tc",{id:`${i}-hh`,name:`${s}-hh`,type:"number",placeholder:"--",min:0,max:23,required:r,readonly:o,disabled:c,"aria-label":`${s}: Hour`,value:this.focus===1?this.cleanHour():this.padHour(),class:h,oninput:N(this.hour),onfocus:()=>this.focus=1,onblur:()=>{this.focus=0;this.touch()}}),t("span.mr-2px",":"),t("input.di.w-100.mw-tt.pa0.bg-transparent.bn.outline-0.tc",{id:`${i}-mm`,name:`${s}-mm`,type:"number",placeholder:"--",min:0,max:59,step:l,required:r,readonly:o,disabled:c,"aria-label":`${s}: Minute`,value:this.focus===2?this.cleanMin():this.padMin(),class:h,oninput:N(this.min),onfocus:()=>this.focus=2,onblur:()=>this.focus=0}),this.showPicker&&t(Dt,{hour:this.hour,min:this.min,step:l==="any"?1:l,config:u,onClose:()=>this.showPicker=false})]),!(c||o)&&t(".pointer",{onclick:()=>this.showPicker=true},T(O("timePickerIcn",u),"ph-2px pv-1px"))]))}}class Et extends Ye{constructor(){super(...arguments);this.showPassword=a(false)}view({attrs:e}){const{field:a,value:n}=e;const{label:i,id:s,name:l=s,title:r=B(i),placeholder:o,maxlength:c,minlength:d,required:u,readonly:h,disabled:p,autofocus:f,autocomplete:m,tabindex:g,pattern:b,inputmode:y,instant:x,uiClass:w={},config:k}=a;return t(Je,{field:a,value:n,invalid:this.invalid,focus:this.inFocus},t(".flex.flex-row.w-100",[t("input.w-100.bg-transparent.bn.outline-0",{id:s,name:l,title:r,placeholder:o,type:this.showPassword()?"text":"password",maxlength:c,minlength:d,required:u,readonly:h,disabled:p,autofocus:f,autocomplete:m,tabindex:g,pattern:b,inputmode:y,class:v(w),value:n(),autocorrect:"off",[x?"oninput":"onchange"]:N(n)}),t(".ml1.pointer.dim",{title:O("showPassTxt",k),onclick:()=>this.showPassword(!this.showPassword()),tabindex:0,onkeydown:j},T(O(this.showPassword()?"hidePassIcn":"showPassIcn",k),"db pa1"))]))}}class Mt extends Ge{labelTranslateY(){return"0.5ex"}}class Rt extends Je{constructor(){super(...arguments);this.layout=Mt}}class Wt extends Ye{constructor(){super(...arguments);this.selector="textarea"}view({attrs:e}){const{field:a,value:n,xform:i=n}=e;const{label:s,id:l,name:r=l,title:o=B(s),placeholder:c,required:d,readonly:u,disabled:h,autofocus:p,autocomplete:f,minlength:m,maxlength:g,tabindex:b,spellcheck:v,rows:y,cols:w,wrap:k,instant:I,uiClass:S={}}=e.field;return t(Rt,{field:a,value:n,xform:i,invalid:this.invalid,focus:this.inFocus},t("textarea.w-100.bg-transparent.bn.outline-0.h-100.resize-none",{id:l,name:r,title:o,placeholder:c,required:d,readonly:u,disabled:h,autofocus:p,autocomplete:f,minlength:m,maxlength:g,tabindex:b,spellcheck:v,rows:y,cols:w,wrap:k,class:x(S),value:n(),[I?"oninput":"onchange"]:N(n)}))}}class _t extends Ye{constructor(){super(...arguments);this.onIcon="checkIcn";this.offIcon="uncheckIcn"}view({attrs:{field:e,value:a}}){const{label:n,id:i,name:s=i,value:l,title:o=B(n),required:c,readonly:d,disabled:u,autocomplete:p,tabindex:m="0",uiClass:g={},config:v}=e;return t("div",{class:f(g,u)},t("fieldset.w-100.bn",{class:b(e,this.invalid,this.inFocus)},[t("input.clip[type=checkbox]",{id:i,name:s,value:l,checked:a(),required:c,autocomplete:p,disabled:u||d,tabindex:-1,"aria-hidden":"true",onchange:H(a,l)}),t("label.db",{class:h([y(e),this.invalid?r.invalidCheckboxWrapper:""]),for:i,title:o,"data-input-id":i,"aria-label":n,tabindex:m,onkeydown:e=>{if(e.key===" "){a(!a())}}},t(Ie,{selected:Boolean(a()),label:n?t("span.mh1",E(n,c)):null,onIcon:O(this.onIcon,v),offIcon:O(this.offIcon,v),config:v}))]))}}class At extends Ye{constructor(){super(...arguments);this.onIcon="toggleOnIcn";this.offIcon="toggleOffIcn"}toggleWrapper(e,a,n){const{label:i,id:s,name:l=s,value:o,title:c=B(i),required:d,readonly:u,disabled:p,autocomplete:f,tabindex:m="0"}=e;return[t("input.clip[type=checkbox]",{id:s,name:l,value:o,checked:a(),required:d,autocomplete:f,disabled:p||u,tabindex:-1,"aria-hidden":"true",onchange:H(a,o)}),t("label.db.flex.justify-content.items-center",{class:h([y(e),this.invalid?r.invalidCheckboxWrapper:""]),for:s,title:c,"data-input-id":s,"aria-label":i,tabindex:m,onkeydown:e=>{if(e.key===" "){a(!a())}}},n)]}toggleInner(e,a){return t(".toggle-outer.relative.dib.transition-bg",{class:e?O("toggleOnWrapper",a):O("toggleOffWrapper",a)},T(O(e?this.onIcon:this.offIcon,a),h(["toggle-inner absolute tc transition-transform",e?"toggle-on":null])))}view({attrs:{field:e,value:a}}){const{label:n,required:i,disabled:s,uiClass:l={},layout:r,config:o}=e;const c=Boolean(a());return r?t(Je,{field:e,value:a,invalid:this.invalid,focus:this.inFocus},this.toggleWrapper(e,a,this.toggleInner(c,o))):t("div",{class:f(l,s)},t("fieldset.w-100.bn",{class:b(e,this.invalid,this.inFocus)},this.toggleWrapper(e,a,[this.toggleInner(c,o),n?t("span.mh1",E(n,i)):null])))}}class Ut extends Ye{view({attrs:e}){const{field:a,value:n}=e;const{label:i,id:s,name:l,value:r,title:o=B(i),required:c,readonly:d,disabled:u,autocomplete:h,tabindex:p="0",uiClass:m={},config:g}=a;const v=n()===r;return t("div",{class:f(m,u)},t("fieldset.w-100.bn",{class:b(a,this.invalid,this.inFocus)},[t("input.clip[type=radio]",{id:s,name:l,value:r,checked:v,required:c,autocomplete:h,disabled:u||d,tabindex:-1,"aria-hidden":"true",onchange:N(n)}),t("label.db",{class:y(a),for:s,title:o,"data-input-id":s,"aria-label":i,tabindex:p,onkeydown:e=>{var t;if(e.key===" "){((t=document.activeElement)===null||t===void 0?void 0:t.firstElementChild).click()}}},t(Ie,{selected:v,label:i?t("span.mh1",E(i,c)):null,onIcon:O("radioOnIcn",g),offIcon:O("radioOffIcn",g),config:g}))]))}}class Nt extends Ye{constructor(){super(...arguments);this.selector="select"}view({attrs:a}){const{field:n,value:i}=a;const{label:s,id:l,name:o=l,title:c=s,required:d,readonly:u,disabled:p,multiple:f,autofocus:m,autocomplete:g,tabindex:b,uiClass:y={},placeholder:x="Select",options:w=[]}=n;const k=i();return t(Xe,{field:n,value:i,invalid:this.invalid,focus:this.inFocus},[s?null:t("legend.screenreader",{id:`${l}-legend`},"Select"),t("select.w-100.bg-transparent.bn.outline-0",{id:l,name:o,title:c,required:d,multiple:f,autofocus:m,autocomplete:g,tabindex:b,disabled:p||u,class:h([v(y),k?"":r.floatLabelPlaceholder]),value:k!==null&&k!==void 0?k:"",onchange:N(i),"aria-labelledby":`${l}-legend`},[e.some(w,(({value:e})=>!e))?null:t("option",{value:"",disabled:true},x),e.map(w,(({value:e,label:a=e})=>t("option",{value:e,disabled:!e||p||u},a)))])])}}class Ht extends Ye{constructor(){super(...arguments);this.onIcon="checkIcn";this.offIcon="uncheckIcn";this.selected=new Set;this.open=false;this.openTs=0;this._focusOption=null;this.keySearch="";this.keyTs=0}get focusOption(){return this._focusOption}set focusOption(e){this.open=e!=null;this._focusOption=e}toggleOpen(){const e=Date.now();if(e-this.openTs>333){this.open=!this.open;this.openTs=e}}toggleSelection(e,t,a){if(!a){this.selected.clear();this.focusOption=null}if(this.selected.has(e)){this.selected.delete(e)}else{this.selected.add(e)}t(Array.from(this.selected).join(","))}moveFocus(t,a){const n=e.findIndex(t,(({value:e})=>e===this.focusOption));const i=e.clamp(n+a,0,t.length-1);this.focusOption=t[i].value}findFocus(t,a){const n=Date.now();if(n-this.keyTs>333){this.keySearch="";this.keyTs=n}this.keySearch+=a;const i=e.find(t,(({value:e,label:t=e})=>String(t).toLowerCase().includes(this.keySearch)));if(i){this.focusOption=i.value}}keyNav(e,t,a,n){if(e.altKey||e.ctrlKey||e.metaKey){return}switch(e.key){case"ArrowDown":{e.preventDefault();this.moveFocus(t,1);break}case"ArrowUp":{e.preventDefault();this.moveFocus(t,-1);break}case" ":case"Enter":{e.preventDefault();if(this.focusOption!=null){this.toggleSelection(String(this.focusOption),a,n)}else{this.toggleOpen()}break}case"Escape":{e.preventDefault();this.focusOption=null;break}default:if(e.key.length===1){e.preventDefault();this.findFocus(t,e.key.toLowerCase())}}}placeHolder(t,a,n){var i,s;if(this.selected.size>1){return`${this.selected.size} Selected`}else if(this.selected.size===1){const l=t();return(s=(i=e.find(a,(e=>String(e.value)===l)))===null||i===void 0?void 0:i.label)!==null&&s!==void 0?s:n}else{return n}}syncSelection(t){if(t()!=null){const a=String(t());const n=a===""?[]:a.split(",");const i=new Set(n);if(!e.isEqual(this.selected,i)){this.selected=i}}}oninit({attrs:{value:e}}){this.syncSelection(e)}onbeforeupdate({attrs:{value:e}}){this.syncSelection(e)}view({attrs:e}){const{field:a,value:n}=e;const{label:i,id:s,name:l=s,title:o=i,required:c,readonly:d,disabled:u,multiple:p,uiClass:f={},placeholder:m="Select",options:g=[],config:b}=a;const y=!(u||d);return t(Xe,{field:a,value:n,invalid:this.invalid,focus:this.inFocus},[t("input.clip[type=text]",{name:l,value:n(),required:c,tabindex:-1,ariaHidden:"true"}),t(".relative.cursor-default",{id:s,title:o,disabled:!y,tabindex:y?0:-1,role:"listbox",class:v(f),onclick:()=>y?this.toggleOpen():undefined,onfocusin:()=>y?this.toggleOpen():undefined,onfocusout:()=>this.focusOption=null,"aria-activedescendant":`${s}-${this.focusOption}`,onkeydown:y?e=>this.keyNav(e,g,n,p):undefined},[t(".flex.items-center",[t(".flex-auto.ph-2px.pv-1px",{class:this.selected.size?undefined:r.floatLabelPlaceholder},this.placeHolder(n,g,m)),T(O("checkListIcn",b),h(["ph-2px pv-1px transition-transform",this.open?"rotate-180":null]))]),this.open&&t(".absolute.z-max.us-none",{class:h([r.checkListOptionsWrapper,O("checkListDropUp",b)?"bottom-0":"mt3"])},p?g.map((e=>this.multiSelectionRow(n,s,e,b))):g.map((e=>this.singleSelectionRow(n,s,e))))])])}singleSelectionRow(e,a,n){const{value:i,label:s=i}=n;const l=this.selected.has(String(i));const o=i===this.focusOption?"true":undefined;return t(".ui-widgets-option.cursor-default",{id:`${a}-${i}`,class:h([r.checkListOption,l?r.checkListOptionSingleSelected:null]),role:"option",ariaSelected:l,"aria-activedescendant":o,onclick:t=>{t.stopPropagation();this.toggleSelection(String(i),e)}},t("span",{class:r.checkListOptionLabel},s))}multiSelectionRow(e,a,n,i){const{value:s,label:l=s}=n;const o=this.selected.has(String(s));const c=o?O(this.onIcon,i):O(this.offIcon,i);const d=s===this.focusOption?"true":undefined;return t(".ui-widgets-option.cursor-default",{id:`${a}-${s}`,class:h([r.checkListOption,o?r.checkListOptionMultiSelected:null]),role:"option",ariaSelected:o,"aria-activedescendant":d,onclick:t=>{t.stopPropagation();this.toggleSelection(String(s),e,true)}},[T(c,r.checkListOptionIcon),t("span",{class:r.checkListOptionLabel},l)])}}class zt{constructor(){this.dragging=a(false)}view({attrs:{field:a,value:n,displayType:i}}){const s=e.head(n());const{disabled:l,uiClass:r={},config:o,readonly:c}=a;const d=i==="none"||!s?O("addFileTxt",o):s.name;return t("div",{class:f(r,l)},t(De,{field:a,multiple:false,dragging:this.dragging,onSet:Fe(n,true),value:n},t(".flex.items-center.pa1",{class:w(r,this.dragging(),Oe(a,n()))},[T(O("uploadIcn",o),"pa1"),t("span.ma1.flex-auto",d),s&&i!=="none"?[t(Me,s),!(c||l)&&t("i.pa1.pointer.dim",{title:`Remove ${s.name}`,class:O("cancelIcn",o),onclick:qe(n,s.guid)})]:null])))}}function Vt(a,n,i=false){return s=>{const l=i?[]:a();return Promise.all(e.map(s,(e=>ie(e,n,e.type).then((t=>{const a=Z(Y(t),e.name);l.push({guid:F(),name:a.name,path:"not_set",file:a,dataUrl:t})}))))).then((()=>{a(l);t.redraw()}))}}class jt{constructor(){this.dragging=a(false)}view({attrs:{field:a,value:n}}){const{disabled:i,uiClass:s={},config:l,readonly:r}=a;return t("div",{class:f(s,i)},[t(De,{field:a,defaultAccept:"image/*",dragging:this.dragging,onSet:Vt(n,O("imageMaxSize",l)),value:n},t(".w-100.pa1.dt.tc",{class:w(s,this.dragging(),Oe(a,n()))},t("i.fa-2x.dtc.v-mid",{class:O("cameraIcn",l)}))),t(".flex.flex-row.flex-wrap.mt1.nr1.nb1.nl1.max-h-thumb",e.map(n(),(e=>t(Ee,{src:R(e.path,e.dataUrl)},!(r||i)&&t(".absolute.top-0.right-0.child",t(de,{title:`Remove ${e.name}`,icon:O("deleteIcn",l),onclick:qe(n,e.guid)}))))))])}}class Kt{constructor(){this.dragging=a(false)}view({attrs:{field:a,value:n}}){const i=e.head(n());const{disabled:s,uiClass:l={},config:r,readonly:o}=a;return t("div",{class:f(l,s)},t(De,{field:a,defaultAccept:"image/*",multiple:false,dragging:this.dragging,onSet:Vt(n,O("imageMaxSize",r),true),value:n},t(".pa1",{class:w(l,this.dragging(),Oe(a,n()))},t(".relative.w-100.dt.tc",i?[t("img.img.contain.max-h-img",{title:i.name,src:R(i.path,i.dataUrl)}),!(o||s)&&t(".absolute.top-0.right-0.pa1.pointer.dim",{title:`Remove ${i.name}`,onclick:qe(n,i.guid)},t("i.pa1",{class:O("cancelIcn",r)}))]:t("i.fa-2x.dtc.v-mid",{class:O("cameraIcn",r)})))))}}class Yt{oncreate({dom:t}){const a=t.children[0];const n=q();this.signaturePad=new s(a,{minWidth:.5*n,maxWidth:1.5*n});const i=()=>{const e=q();a.width=a.offsetWidth*e;a.height=a.offsetHeight*e;const t=a.getContext("2d");t.scale(e,e);this.resetCanvas()};this.resizeHandler=e.debounce(i,250);window.addEventListener("resize",this.resizeHandler);window.addEventListener("orientationchange",this.resizeHandler);i()}onremove(){this.resizeHandler.cancel();window.removeEventListener("resize",this.resizeHandler);window.removeEventListener("orientationchange",this.resizeHandler)}view({attrs:{style:e,config:a,onSet:n,onCancel:i}}){return[t(".aspect-ratio.bg-white.ba.bw1.br3.b--dashed.b--black-30",{style:e},t("canvas.aspect-ratio--object")),t(".absolute.top-0.right-0.z-999.translate-up-100",[t(de,{title:O("applyTtl",a),icon:O("applyIcn",a),classes:"ma1",onclick:()=>{if(!this.signaturePad.isEmpty()){n(this.signaturePad.toDataURL("image/png"))}}}),t(de,{title:O("resetTtl",a),icon:O("resetIcn",a),classes:"ma1",onclick:()=>this.resetCanvas()}),t(de,{title:O("cancelTtl",a),icon:O("cancelIcn",a),classes:"ma1",onclick:i})])]}resetCanvas(){this.signaturePad.clear()}}class Zt{constructor(){this.text=a("")}oncreate({dom:e}){const t=e.children[0];t.focus({preventScroll:false});this.scaleText(e)}onupdate({dom:e}){this.scaleText(e)}view({attrs:{heightPct:a,style:n,config:i,onSet:s,onCancel:l}}){const r=e.flow([e.partial(re,this.text(),a,i),e.partialRight(s,{text:this.text(),heightPct:a}),e.stubFalse]);return[t("form.aspect-ratio.ba.bw1.br3.b--dashed.b--black-30",{style:n,onsubmit:r},t("input.aspect-ratio--object.pa2.ba.bw0[type=text]",{oninput:N(this.text),style:{fontFamily:O("signFont",i)},value:this.text()})),t(".absolute.top-0.right-0.z-999.translate-up-100",[t(de,{title:O("applyTtl",i),icon:O("applyIcn",i),classes:"ma1",onclick:r}),t(de,{title:O("resetTtl",i),icon:O("resetIcn",i),classes:"ma1",onclick:()=>this.text("")}),t(de,{title:O("cancelTtl",i),icon:O("cancelIcn",i),classes:"ma1",onclick:l})])]}scaleText(e){const t=e.clientHeight;e.style.fontSize=`${.56*t}px`}}class Gt{view({attrs:{heightPct:a,stampTxt:n,stampSetTxt:i,config:s,onSet:l}}){return[t("span.clip",{style:{fontFamily:O("signFont",s)}},i),t(".flex",t(de,{label:n,classes:`flex-auto ${O("stampBtnClass",s)}`,context:O("stampBtnContext",s),onclick:e.flow([e.partial(re,i,a,s),e.partialRight(l,{text:i,heightPct:a})])}))]}}const Jt={["draw"]:Yt,["type"]:Zt,["stamp"]:Gt};function Qt(e,a,n){return(i,s)=>se(i,n).then((n=>{e([G(n,`sign-${a}.png`,s)]);t.redraw()}))}class Xt{oninit({attrs:{value:e}}){this.valUpdate=e.map((()=>this.setSignType()))}onremove(){this.valUpdate.end()}view({attrs:{field:a,value:n}}){const{label:i,id:s,readonly:l,disabled:o,tabindex:c="0",uiClass:d={},config:u,options:h,heightPct:p=O("signHeightPct",u),stampTxt:m=O("stampTxt",u),stampSetTxt:g=O("stampSetTxt",u)}=a;const b={paddingBottom:`${p}%`};const v=e.head(n());const y=h?e(h).map((({value:e})=>String(e)in Jt?e:null)).compact().value():O("signOpts",u);const x=e.map(y,(e=>{switch(e){case"draw":return{type:e,icon:O("drawIcn",u),label:O("signDrawTxt",u)};case"type":return{type:e,icon:O("typeIcn",u),label:O("signTypeTxt",u)};case"stamp":return{type:e,icon:O("stampIcn",u),label:O("signStampTxt",u)}}}));if(x.length===1&&!v){this.setSignType(x[0].type)}return t("div.relative",{class:f(d,o)},[A(s,d,i),l||o?t(".aspect-ratio",{id:s,style:b},v?t(".aspect-ratio--object",{class:"pe-none"},t("img.img.w-100.absolute",{src:R(v.path,v.dataUrl)})):null):this.signType?t(Jt[this.signType],{heightPct:p,stampTxt:m,stampSetTxt:g,style:b,config:u,onSet:Qt(n,s,O("signMaxSize",u)),onCancel:e.bind(this.setSignType,this,undefined)}):t(".aspect-ratio.pointer",{id:s,class:r.fileInputWrapper,style:b},v?t(".aspect-ratio--object.dim",{onclick:e.bind(n,this,[])},[t("img.img.w-100.absolute",{src:R(v.path,v.dataUrl)}),t(".absolute.top-1.right-1",t("i.fa-2x",{class:O("resetIcn",u),tabindex:0,onkeydown:j}))]):t(".aspect-ratio--object.flex",e.map(x,(({type:a,icon:n,label:i})=>t(".flex-auto.flex.items-center.justify-center.dim",{title:i,tabindex:c,onkeydown:j,onclick:e.bind(this.setSignType,this,a)},T(n,"fa-2x ma1"),t("span.ma1.dn.db-ns.truncate",i))))))])}setSignType(e){this.signType=e}}function ea(a,n){return i=>{const s=n?[]:a();return Promise.all(e.map(i,(e=>{if(Q(e.type)){return ie(e,S.imageMaxSize,e.type).then((t=>{const a=Z(Y(t),e.name);s.push({guid:F(),name:a.name,path:"not_set",file:a,dataUrl:t})}))}else{s.push({guid:F(),name:e.name,path:"not_set",file:e});return Promise.resolve()}}))).then((()=>{a(s);t.redraw()}))}}class ta{constructor(){this.dragging=a(false)}view({attrs:e}){const{field:a,value:n}=e;const{disabled:i,uiClass:s={}}=a;return t("div",{class:f(s,i)},t(De,{field:a,value:n,multiple:false,dragging:this.dragging,onSet:ea(n,true)},t(".flex.items-center.pa1",{class:w(s,this.dragging(),Oe(a,n()))},this.innerComponent(e))))}innerComponent({field:{disabled:a,config:n,readonly:i},value:s}){const l=e.head(s());if(l){if(l.dataUrl){return t(".relative.w-100.dt.tc",t("img.img.contain.max-h-img",{title:l.name,src:R(l.path,l.dataUrl)}),!(i||a)&&t(".absolute.top-0.right-0.pa1.pointer.dim",{title:`Remove ${l.name}`,onclick:qe(s,l.guid)},t("i.pa1",{class:O("cancelIcn",n)})))}else{return[t(Me,l),t("span.ma1.flex-auto",{title:l.name},l.name),!(i||a)&&t("i.pa1.pointer.dim",{title:`Remove ${l.name}`,class:O("cancelIcn",n),onclick:qe(s,l.guid),onkeydown:j,tabindex:0})]}}else{return[T(O("uploadIcn",n),"pa1"),t("span.ma1",O("addFileTxt",n))]}}}class aa{constructor(){this.dragging=a(false)}view({attrs:{field:e,value:a,displayType:n,showDisplay:i=true}}){const{disabled:s,uiClass:l={},config:r,readonly:o}=e;return t("div",{class:f(l,s)},[t(De,{field:e,value:a,dragging:this.dragging,onSet:ea(a,false)},t(".flex.items-center.pa1.dt",{class:w(l,this.dragging(),Oe(e,a()))},[T(O("uploadIcn",r),"pa1"),t("span.ma1.flex-auto",O("addFileTxt",r))])),i?t(Re,{displayType:n,value:a,readonlyOrDisabled:s||o,config:r}):null])}}class na extends De{constructor(){super(...arguments);this.showLabel=false}}class ia{constructor(){this.dragging=a(false)}view({attrs:{field:e,value:a}}){const{id:n,required:i,uiClass:s={},config:l,label:o={text:"Add File",icon:O("uploadIcn",l)}}=e;return[A(n,s,o,i),t("div",{class:`${w(s,this.dragging(),Oe(e,a()))} ${u()} ${r.button}`},t(na,{field:e,multiple:false,dragging:this.dragging,onSet:Fe(a,true),value:a},t(".flex.items-center",typeof o==="string"?U({text:o,icon:O("uploadIcn",l)}):U(o))))]}}class sa{oncreate({dom:e}){this.container=e}onbeforeupdate({attrs:{visible:e}},{attrs:{visible:t}}){if(e===t){return e}else{this.container.style.height=e?"auto":this.container.getBoundingClientRect().height+"px";return true}}view({attrs:{items:e,idx:a,visible:n,component:i,fragment:s}}){return t("div",{"data-idx":a},n?e.map((e=>t.fragment(s(e),[t(i,e)]))):null)}}class la{constructor(){this.scrollHandler=e.throttle((e=>{const t=e.scrollTop/e.scrollHeight||0;this.controller.updateScroll(t)}),50,{leading:false})}static fragment(){return{}}oninit({attrs:{controller:e}}){this.controller=e}view({attrs:{component:e,classes:a="overflow-y-auto",fragment:n=la.fragment}}){return t("div",{class:a,onscroll:e=>{e.redraw=false;this.scrollHandler(e.target)}},this.controller.render((({items:a,idx:i,visible:s})=>t(sa,{items:a,idx:i,visible:s,component:e,fragment:n}))))}}class ra{static clampRange(e,t,a){return Math.max(e,Math.min(t,a))}static single(e){const a=new ra((()=>e().then((e=>{a.updateDataStore(e);a.applySort();t.redraw()}))));return a}static paging(e){const a=ra.BLOCK_SIZE*4;const n=new ra((i=>e(i,a+1).then((e=>{if(e.length>a){n.updateDataStore(e.slice(0,a),true)}else{n.updateDataStore(e)}t.redraw()}))));return n}get data(){return this.dataStore}get sortedData(){return this.sortedDataStore}get filteredData(){return this.filteredDataStore}get availableBlocks(){return Math.ceil(this.filteredDataStore.length/ra.BLOCK_SIZE)}get loading(){return this.isLoading}setSort(e){this.sortFn=e}applySort(){this.sortedDataStore=this.sortFn(this.dataStore);this.applyFilter()}setFilter(e){this.filterFn=e}applyFilter(){this.filteredDataStore=this.filterFn(this.sortedDataStore);this.invalidate();this.updateBlockRange()}reload(){this.bufferReload=this.loading;if(!this.bufferReload){this.dataStore.splice(0,this.dataStore.length);this.invalidate();this.load()}}updateScroll(e){if(this.dataStore.length>0){this.scrollPct=e;this.updateBlockRange()}}updateDataStore(e,t=false){this.loadMore=t;this.dataStore.push(...e);this.updateBlockRange()}render(e){return this.blockStore.map(((t,a)=>e({items:t,idx:a,visible:a>=this.startBlock&&a<this.endBlock})))}debug(){return{data:this.data.length,filtered:this.filteredData.length,blocks:this.blockStore.length,start:this.startBlock,end:this.endBlock}}constructor(t){this.dataLoader=t;this.dataStore=[];this.sortFn=e.identity;this.sortedDataStore=this.dataStore;this.filterFn=e.identity;this.filteredDataStore=this.sortedDataStore;this.blockStore=[];this.scrollPct=0;this.startBlock=-1;this.endBlock=-1;this.loadMore=false;this.isLoading=false;this.bufferReload=false;this.load()}invalidate(){this.startBlock=-1;this.endBlock=-1;this.blockStore.splice(0,this.blockStore.length)}load(){if(!this.loading){this.isLoading=true;t.redraw();this.dataLoader(this.data.length).catch(console.error).then((()=>{this.isLoading=false;if(this.bufferReload){this.reload()}}))}}updateBlockRange(){const e=ra.clampRange(0,Math.floor(this.scrollPct*this.blockStore.length)-1,this.availableBlocks-ra.BLOCK_RANGE);if(e!==this.startBlock){this.startBlock=e;this.endBlock=e+ra.BLOCK_RANGE;this.ensureBlockStore();t.redraw()}}ensureBlockStore(){let e=this.blockStore.length*ra.BLOCK_SIZE;const t=Math.min(this.endBlock,this.availableBlocks)*ra.BLOCK_SIZE;while(e<t){const t=e+ra.BLOCK_SIZE;this.blockStore.push(this.filteredDataStore.slice(e,t));e=t}if(this.loadMore&&t>=this.dataStore.length){this.load()}}}ra.BLOCK_SIZE=25;ra.BLOCK_RANGE=3;class oa extends ra{constructor(){super(...arguments);this.pageStride=oa.PAGE_STRIDE;this.page=0}static single(e){const a=new oa((()=>e().then((e=>{a.updateDataStore(e);a.applySort();t.redraw()}))));return a}static paging(e){const a=ra.BLOCK_SIZE*4;const n=new oa((i=>e(i,a+1).then((e=>{if(e.length>a){n.updateDataStore(e.slice(0,a),true)}else{n.updateDataStore(e)}t.redraw()}))));return n}set blockStride(e){this.pageStride=e;this.updatePage(0)}updatePage(e){this.page=ra.clampRange(0,e,this.lastPage);this.startBlock=this.page*this.pageStride;this.endBlock=this.startBlock+this.pageStride;this.ensureBlockStore();t.redraw()}get currentPage(){return this.page+1}get lastPage(){return Math.ceil(this.availableBlocks/this.pageStride)}get canPageForward(){return!this.loading&&this.currentPage<this.lastPage}get canPageBackward(){return!this.loading&&this.page>0}get rowsPerPage(){return this.pageStride*ra.BLOCK_SIZE}setPage(e){this.updatePage(e-1)}pageRelative(e){this.updatePage(this.page+e)}render(e){return this.blockStore.slice(this.startBlock,this.endBlock).map(((t,a)=>e({items:t,idx:a,visible:true})))}debug(){return Object.assign(Object.assign({},super.debug()),{blockStride:this.pageStride,page:this.page})}updateBlockRange(){if(this.startBlock===-1){this.updatePage(0)}if(this.endBlock>=this.blockStore.length){this.ensureBlockStore()}}}oa.PAGE_STRIDE=4;export{ce as Badge,tt as BaseInput,be as BaseText,de as Button,ue as ButtonLink,Ot as CardDateInput,Ht as CheckList,Se as Checkbox,_t as CheckboxInput,oe as Currency,at as CurrencyInput,Ct as DateInput,ve as DateText,Re as DisplayTypeComponent,ia as FileButtonSelect,_e as FileList,Be as FileMulti,zt as FileSelect,Ae as ImageList,jt as ImageMulti,Ue as ImagePreview,Kt as ImageSelect,Ke as Label,ke as Link,la as List,ra as ListController,aa as MultiOmniFileInput,he as NavButton,pe as NavLink,ta as OmniFileInput,oa as PageController,Et as PasswordInput,je as PasswordStrength,ct as PercentageInput,Ut as RadioInput,Nt as SelectInput,We as SelectText,Xt as SignBuilder,Wt as TextareaInput,Bt as TimeInput,$e as Toggle,At as ToggleInput,me as Tooltip,ge as Trusted,re as createStamp,lt as currencyStrToNumber,Y as dataURItoBlob,G as dataUrlToFile,Z as fileConstructor,K as fileNameExtSplit,st as formatCurrency,X as getOrientation,F as guid,xe as iconMap,h as joinClasses,ye as linkAttrs,we as linkIcon,rt as numberToCurrencyStr,ot as numberToCurrencyTuple,q as pxRatio,ee as readArrayBuffer,te as readOrientation,P as registerFunction,ie as resizeImage,se as scaleDataUrl,ne as scaleRect,le as textToImage,r as theme,d as updateButtonContext,o as updateClasses,$ as updateConfig};
